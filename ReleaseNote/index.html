<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MirAI | Release Notes</title>
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/Allwaysever/MirAI/refs/heads/main/Assets/Favicon.png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Marked.js -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <style>
        :root {
            --color-accent: #ffce00;
            --color-primary: #ffffff;
            --color-dark-bg: #0f0f0f;
            --color-card-bg: rgba(33, 33, 33, 0.7);
            --color-border: #4B4F50;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: var(--color-dark-bg);
            color: var(--color-primary);
            margin: 0;
            min-height: 100vh;
        }
        
        .card-srui {
            border-radius: 25px;
            background: var(--color-card-bg);
            border: 1px solid var(--color-border);
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.2);
        }
        
        .link-button {
            background: var(--color-accent);
            color: var(--color-dark-bg);
            font-weight: bold;
            border-radius: 9999px;
            padding: 7.5px 18px;
            text-decoration: none;
            font-size: 0.8rem;
            display: inline-block;
            transition: all 0.2s;
            border: 2px solid var(--color-accent);
        }
        
        .link-button:hover {
            background: #e6b800;
            transform: translateY(-1px);
        }
        
        .loader {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 206, 0, 0.3);
            border-radius: 50%;
            border-top-color: #ffce00;
            animation: spin 1s ease-in-out infinite;
            margin: 40px auto;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <!-- Simple Header -->
    <header style="
        background: rgba(15, 15, 15, 0.95); 
        backdrop-filter: blur(5px); 
        padding: 20px; 
        border-bottom: 1px solid #333; 
        position: sticky; 
        top: 0; 
        z-index: 100;
    ">
        <div style="
            max-width: 1200px; 
            margin: 0 auto; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            padding: 0 20px;
        ">
            <div style="display: flex; align-items: center; gap: 15px;">
                <img src="https://raw.githubusercontent.com/Allwaysever/MirAI/refs/heads/main/Assets/Logo%20Icon.png" 
                     style="width: 40px; height: 40px; border-radius: 10px;"
                     alt="MirAI Logo">
                <div>
                    <div style="font-size: 1.5rem; font-weight: bold; color: white;">MirAI</div>
                    <div style="font-size: 1rem; color: #aaa;">Release Notes</div>
                </div>
            </div>
            <a href="https://allwaysevermirai.netlify.app" class="link-button">
                Open MirAI
            </a>
        </div>
    </header>

    <main style="max-width: 1200px; margin: 0 auto; padding: 20px 10px; min-height: 70vh;">
        <!-- Loading Indicator -->
        <div id="loading" style="text-align: center; padding: 60px 20px;">
            <div class="loader"></div>
            <p style="color: #aaa; margin-top: 20px; font-size: 1.1rem;">
                Loading changelog from GitHub...
            </p>
        </div>

        <!-- Error Message -->
        <div id="error" style="display: none; text-align: center; padding: 60px 20px;">
            <div class="card-srui" style="max-width: 600px; margin: 0 auto; padding: 40px;">
                <h3 style="font-size: 1.5rem; color: #ffce00; margin-bottom: 15px;">
                    ‚ö†Ô∏è Failed to Load Changelog
                </h3>
                <p id="error-message" style="color: #aaa; margin-bottom: 25px;">
                    Could not fetch the changelog from GitHub.
                </p>
                <button onclick="loadChangelog()" class="link-button">
                    Try Again
                </button>
            </div>
        </div>

        <!-- Changelog Content -->
        <div id="changelog" style="display: none;">
            <!-- Content will be loaded here -->
        </div>
    </main>

    <footer style="
        text-align: center; 
        padding: 30px; 
        border-top: 1px solid #333; 
        color: #666; 
        margin-top: 60px;
    ">
        <p>&copy; 2025-2026 Allwaysever Project: MirAI</p>
        <p style="font-size: 0.9rem; color: #888; margin-top: 5px;">
            Changelog loaded from GitHub
        </p>
    </footer>

    <script>
        // Configuration
        const CHANGELOG_URL = 'https://raw.githubusercontent.com/Allwaysever/MirAI/main/Docs/CHANGELOG.md';
        
        // DOM Elements
        const loadingEl = document.getElementById('loading');
        const errorEl = document.getElementById('error');
        const errorMessageEl = document.getElementById('error-message');
        const changelogEl = document.getElementById('changelog');
        
        // Configure marked.js
        marked.setOptions({
            breaks: true,
            gfm: true,
            headerIds: true
        });
        
        // Simple fetch with error handling
        async function fetchChangelog() {
            console.log('üîç Fetching changelog from:', CHANGELOG_URL);
            
            try {
                // Try multiple methods
                const methods = [
                    // Method 1: Direct fetch (might work with CORS headers)
                    async () => {
                        const res = await fetch(CHANGELOG_URL, {
                            headers: {
                                'Accept': 'text/plain',
                                'Cache-Control': 'no-cache'
                            }
                        });
                        if (!res.ok) throw new Error(`HTTP ${res.status}`);
                        return await res.text();
                    },
                    
                    // Method 2: Using CORS proxy
                    async () => {
                        const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(CHANGELOG_URL)}`;
                        const res = await fetch(proxyUrl);
                        if (!res.ok) throw new Error(`Proxy HTTP ${res.status}`);
                        return await res.text();
                    },
                    
                    // Method 3: Another CORS proxy
                    async () => {
                        const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(CHANGELOG_URL)}`;
                        const res = await fetch(proxyUrl);
                        if (!res.ok) throw new Error(`Proxy 2 HTTP ${res.status}`);
                        return await res.text();
                    },
                    
                    // Method 4: RawGit CDN (alternative)
                    async () => {
                        const rawgitUrl = CHANGELOG_URL.replace(
                            'https://raw.githubusercontent.com/',
                            'https://cdn.jsdelivr.net/gh/'
                        ).replace('/main/', '@main/');
                        const res = await fetch(rawgitUrl);
                        if (!res.ok) throw new Error(`CDN HTTP ${res.status}`);
                        return await res.text();
                    }
                ];
                
                // Try each method until one works
                for (let i = 0; i < methods.length; i++) {
                    try {
                        console.log(`Trying method ${i + 1}...`);
                        const content = await methods[i]();
                        console.log(`‚úÖ Method ${i + 1} successful!`);
                        return content;
                    } catch (methodError) {
                        console.log(`Method ${i + 1} failed:`, methodError.message);
                        if (i === methods.length - 1) throw methodError;
                    }
                }
                
            } catch (error) {
                console.error('‚ùå All fetch methods failed:', error);
                throw error;
            }
        }
        
        // Load and display changelog
        async function loadChangelog() {
            console.log('üöÄ Starting changelog load...');
            
            // Show loading, hide others
            loadingEl.style.display = 'block';
            errorEl.style.display = 'none';
            changelogEl.style.display = 'none';
            
            try {
                // Fetch markdown
                const markdown = await fetchChangelog();
                console.log('‚úÖ Changelog fetched, length:', markdown.length);
                
                // Parse to HTML
                const html = marked.parse(markdown);
                
                // Create container
                const container = document.createElement('div');
                container.className = 'card-srui';
                container.style.padding = '40px';
                container.style.marginBottom = '30px';
                
                
                // Add content
                const contentDiv = document.createElement('div');
                contentDiv.innerHTML = html;
                
                // Style the content
                contentDiv.querySelectorAll('h1, h2, h3, h4').forEach(h => {
                    h.style.color = '#ffce00';
                    h.style.marginTop = '30px';
                    h.style.marginBottom = '15px';
                });
                
                contentDiv.querySelectorAll('h1').forEach(h => {
                    h.style.fontSize = '2rem';
                    h.style.borderBottom = '1px solid #4B4F50';
                    h.style.paddingBottom = '8px';
                });
                
                contentDiv.querySelectorAll('h2').forEach(h => {
                    h.style.fontSize = '1.5rem';
                });
                
                contentDiv.querySelectorAll('code').forEach(code => {
                    code.style.background = 'rgba(255, 206, 0, 0.1)';
                    code.style.color = '#ffce00';
                    code.style.padding = '2px 6px';
                    code.style.borderRadius = '4px';
                    code.style.fontFamily = 'monospace';
                });
                
                contentDiv.querySelectorAll('pre').forEach(pre => {
                    pre.style.background = 'rgba(33, 33, 33, 0.9)';
                    pre.style.border = '1px solid #4B4F50';
                    pre.style.borderRadius = '10px';
                    pre.style.padding = '15px';
                    pre.style.overflowX = 'auto';
                    pre.style.margin = '20px 0';
                });
                
                contentDiv.querySelectorAll('a').forEach(a => {
                    a.style.color = '#ffce00';
                    a.style.textDecoration = 'none';
                    a.style.borderBottom = '1px dotted #ffce00';
                });
                
                contentDiv.querySelectorAll('a').forEach(a => {
                    if (a.href && !a.href.includes(window.location.hostname)) {
                        a.target = '_blank';
                        a.rel = 'noopener noreferrer';
                    }
                });
                
                contentDiv.querySelectorAll('ul, ol').forEach(list => {
                    list.style.margin = '15px 0';
                    list.style.paddingLeft = '20px';
                });
                
                contentDiv.querySelectorAll('li').forEach(li => {
                    li.style.margin = '8px 0';
                    li.style.color = '#aaa';
                });
                
                contentDiv.querySelectorAll('p').forEach(p => {
                    p.style.margin = '15px 0';
                    p.style.color = '#aaa';
                    p.style.lineHeight = '1.6';
                });
                
                contentDiv.querySelectorAll('blockquote').forEach(blockquote => {
                    blockquote.style.borderLeft = '4px solid #ffce00';
                    blockquote.style.paddingLeft = '15px';
                    blockquote.style.margin = '20px 0';
                    blockquote.style.color = '#aaa';
                    blockquote.style.fontStyle = 'italic';
                });
                
                container.appendChild(contentDiv);
                
                // Add metadata footer
                const footer = document.createElement('div');
                footer.style.marginTop = '40px';
                footer.style.paddingTop = '20px';
                footer.style.borderTop = '1px solid #4B4F50';
                footer.style.display = 'flex';
                footer.style.justifyContent = 'space-between';
                footer.style.flexWrap = 'wrap';
                footer.style.gap = '15px';
                footer.style.color = '#666';
                footer.style.fontSize = '0.9rem';
                
                const sourceLink = document.createElement('a');
                sourceLink.href = 'https://github.com/Allwaysever/MirAI/blob/main/Docs/CHANGELOG.md';
                sourceLink.target = '_blank';
                sourceLink.textContent = 'View on GitHub ‚Üó';
                sourceLink.style.color = '#ffce00';
                sourceLink.style.textDecoration = 'none';
                
                const timestamp = document.createElement('div');
                timestamp.textContent = `Loaded: ${new Date().toLocaleTimeString([], { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit'
                })}`;
                
                const sizeInfo = document.createElement('div');
                sizeInfo.textContent = `Size: ${(markdown.length / 1024).toFixed(1)} KB`;
                
                footer.appendChild(sourceLink);
                footer.appendChild(timestamp);
                footer.appendChild(sizeInfo);
                
                container.appendChild(footer);
                
                // Clear and add to page
                changelogEl.innerHTML = '';
                changelogEl.appendChild(container);
                
                // Show content, hide loading
                loadingEl.style.display = 'none';
                changelogEl.style.display = 'block';
                
                console.log('üéâ Changelog displayed successfully!');
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                
                // Show error
                loadingEl.style.display = 'none';
                errorEl.style.display = 'block';
                errorMessageEl.textContent = `Error: ${error.message}`;
            }
        }
        
        // Auto-load on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ Page loaded, auto-loading changelog...');
            loadChangelog();
            
            // Auto-refresh every 10 minutes
            setInterval(() => {
                console.log('üîÑ Auto-refreshing...');
                loadChangelog();
            }, 10 * 60 * 1000);
        });
        
        // Make function available globally
        window.loadChangelog = loadChangelog;
    </script>
</body>
</html>
