<!DOCTYPE html>

<html lang="id">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>MirAI</title>

    <meta name="description" content="MirAI is a chatbot and personal AI assistant powered by Google Gemini. Get answers, creative ideas, translations, and other help instantly.">

    <meta name="keywords" content="Allwaysever, AI, Artificial Intelligence, Chatbot AI, AI Chatbot, Gemini 2.5 flash, Google Gemini, Gemini API, MirAI">

    <meta name="google-site-verification" content="Ww9spnmeAgguaCwvLVAw-0SV0_ZS-bA7bjNgyWKaeQU"/>

<meta property="og:title" content="MirAI" />
<meta property="og:description" content="MirAI is a chatbot and personal AI assistant powered by Google Gemini. Get answers, creative ideas, translations, and other help instantly." />
<meta property="og:url" content="https://allwaysevermirai.netlify.app/" />
<meta property="og:image" content="https://raw.githubusercontent.com/Allwaysever/MirAI/refs/heads/main/Assets/MirAI%20Banner.png" />

<meta property="og:type" content="article" /> <meta property="og:site_name" content="MirAI by Allwaysever" />

    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/Allwaysever/MirAI/refs/heads/main/Assets/Favicon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Allwaysever/MirAI@main/Assets/HTML/MirAIStyle.css">
   <link rel="manifest" href="https://cdn.jsdelivr.net/gh/Allwaysever/MirAI@main/Assets/HTML/MirAIPWAm.json">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<!-- Untuk fullscreen di iOS -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="MirAI">

<!-- Untuk Android/Chrome -->
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#1a1a1a">

<!-- Untuk Windows -->
<meta name="msapplication-TileColor" content="#1a1a1a">
<meta name="msapplication-TileImage" content="https://raw.githubusercontent.com/Allwaysever/MirAI/refs/heads/main/Assets/Favicon.png">
<meta name="msapplication-config" content="browserconfig.xml">

<!-- Icons untuk berbagai platform -->
<link rel="apple-touch-icon" sizes="180x180" href="https://raw.githubusercontent.com/Allwaysever/MirAI/refs/heads/main/Assets/Favicon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://raw.githubusercontent.com/Allwaysever/MirAI/refs/heads/main/Assets/Favicon.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://raw.githubusercontent.com/Allwaysever/MirAI/refs/heads/main/Assets/Favicon.png">
<link rel="mask-icon" href="https://raw.githubusercontent.com/Allwaysever/MirAI/refs/heads/main/Assets/Favicon.png" color="#1a1a1a">
<script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>

    <script>
        // notif sw onesignal
  window.OneSignalDeferred = window.OneSignalDeferred || [];
  OneSignalDeferred.push(async function(OneSignal) {
    await OneSignal.init({
      appId: "9b77aea2-462f-498d-be06-bc4f75ab7ab7",
      safari_web_id: "web.onesignal.auto.31f2bfbe-48d0-4a72-b7e0-d44022a2d3bb",
      notifyButton: {
        enable: false,
      },
    });
  });
    
// Di dalam script utama (setelah DOMContentLoaded)
let deferredPrompt;

window.addEventListener('beforeinstallprompt', (e) => {
  // Mencegah tampilan prompt otomatis
  e.preventDefault();
  // Simpan event untuk digunakan nanti
  deferredPrompt = e;
  
  // Tampilkan tombol install custom
  showInstallButton();
});

function showInstallButton() {
  const installBtn = document.createElement('button');
  installBtn.id = 'installBtn';
  installBtn.innerHTML = '<i class="fas fa-download"></i> Install App';
  installBtn.style.cssText = `
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #4285f4;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 25px;
    cursor: pointer;
    z-index: 1000;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  `;
  
  installBtn.addEventListener('click', async () => {
    if (deferredPrompt) {
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      console.log(`User response to the install prompt: ${outcome}`);
      deferredPrompt = null;
      installBtn.remove();
    }
  });
  
  document.body.appendChild(installBtn);
}

// Cek jika app sudah diinstall
window.addEventListener('appinstalled', (evt) => {
  console.log('PWA was installed successfully!');
  // Hapus tombol install jika ada
  const installBtn = document.getElementById('installBtn');
  if (installBtn) installBtn.remove();
});

  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('https://cdn.jsdelivr.net/gh/Allwaysever/MirAI@main/Assets/HTML/MirAIPWAsw.js')
        .then(function(registration) {
          console.log('ServiceWorker registered successfully');
        })
        .catch(function(err) {
          console.log('ServiceWorker registration failed: ', err);
        });
    });
  }
  
// Cek apakah service worker terdaftar
navigator.serviceWorker.getRegistrations().then(registrations => {
  console.log('Registered Service Workers:', registrations);
});

// Atau cek spesifik
if ('serviceWorker' in navigator) {
  console.log('Service Worker supported');
  
  navigator.serviceWorker.ready.then(registration => {
    console.log('Service Worker is ready:', registration);
  });
}

// Auto-generate version based on date
function generateVersion(major, minor, patch) {
    const now = new Date();
    const yymmdd = now.getFullYear().toString().slice(-2) + 
                   String(now.getMonth() + 1).padStart(2, '0') + 
                   String(now.getDate()).padStart(2, '0');
    
    return `${major}.${minor}.${patch}.${yymmdd}`;
} 

// Usage
const VERSION = '2.12.0-Beta4'; // generateVersion(2, 12, 0);
</script>
</head>

<body>
    <script>
        if (new URLSearchParams(window.location.search).has('pwa')) {
            document.documentElement.classList.add('pwa-mode');
            // Tambahkan gaya instan ke head agar tidak ada jeda
            const style = document.createElement('style');
            style.innerHTML = '#splash-screen { display: none !important; }';
            document.head.appendChild(style);
        }
    </script>
    
    <div id="splash-screen">

  <div class="splash-content">

    <img src="https://raw.githubusercontent.com/Allwaysever/MirAI/refs/heads/main/Assets/Name%20Logo.png" alt="MirAI" class="splash-logo logo-img">

    <div class="loading-bar-container" id="splash-loader">

        <div class="loading-bar"></div>

    </div>
<p style="font-size: 0.5em; color: #aaa; bottom: 5px;"  id="settingsVersionText"></p>
  </div>
</div>



<div id="settingsBtnContainer">

    <button id="settingsBtn">

        <i class="fas fa-bars"></i>

    </button>

</div>

<div id="clearBtnContainer">

    <button id="clearBtn">

        <i class="fas fa-trash-alt"></i>

    </button>

</div>



<div id="connectionStatus">

    <span id="statusDot" class="status-dot"></span>

    <span id="statusLabel" class="status-label"></span>

</div>



<div class="logo-container">

    <img src="https://raw.githubusercontent.com/Allwaysever/MirAI/refs/heads/main/Assets/HI%20new.png" alt="what are we talking about?" class="hi-img">

</div>



<div id="languageSwitcher">

    <select id="langDropdown" class="lang-dropdown">

        <option value="id">ğŸ‡®ğŸ‡© Bahasa Indonesia</option>

        <option value="en">ğŸ‡ºğŸ‡¸ English (US)</option>

        <option value="en-uk">ğŸ‡¬ğŸ‡§ English (UK)</option>

        <option value="jp">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>

    </select>

</div>



<div class="chat-container">

    <div id="chatMessages"></div>

</div>





<div id="toolsMenu" class="suggestion-box"></div>



<div id="inputContainer" class="input-container centered">



    <div id="imagePreviewContainer" class="imagePreviewContainer">

       <div class="imagePreviewWrapper">

        <img id="imagePreview" src="" alt="Image Preview" class="imagePreview"">

        <button id="removeImageBtn" class="imgRemoveBtn"><i class="fas fa-times"></i></button>

    </div>

</div>

    

    <div id="suggestionBox" class="suggestion-box"></div>

    <div class="input-box">

        <button id="toolsBtn">

            <i class="fas fa-plus"></i>

        </button>

<button id="uploadImageBtn">

    <i class="fas fa-paperclip"></i>

</button>

<input type="file" id="imageInput" accept="image/*" style="display: none;">

        <textarea id="questionInput" rows="1"></textarea>

        <button id="sendBtn">

            <i class="fas fa-paper-plane"></i>

        </button>

        <button id="stopBtn" style="display: none;">

            <i class="fas fa-stop"></i>

        </button>

    </div>

    <p id="infoText" class="info-text"></p>

</div>



<!-- GANTI SEMUA bagian #settingsPage di chat.html dengan ini: -->
<div id="settingsPage">
    <!-- Header tetap di atas -->
    <div class="settings-header">
        <h2 id="settingsHeaderTitle">Pengaturan</h2>
        <button id="backBtn"><i class="fas fa-times"></i></button>
    </div>

    <!-- Container untuk konten yang bisa discroll -->
    <div class="settings-scroll-container">
        <!-- Semua konten settings pindah ke sini -->
        <div class="settings-content">
            <h3 id="settingsAppearanceTitle">Tampilan</h3>
            <div class="settings-option">
                <p id="settingsThemeText">Pilih preferensi tema Anda:</p>
                <select id="themeSelect">
                    <option value="light" id="themeLightOption">Terang</option>
                    <option value="dark" id="themeDarkOption">Gelap</option>
                </select>
            </div>
            
            <h3 id="settingsAITitle">Persona AI</h3>
            <div class="settings-option">
                <p id="settingsPersonaText">Pilih gaya respons AI:</p>
                <select id="personaSelect">
                    <option value="formal" id="personaFormalOption">Formal & Profesional</option>
                    <option value="default" id="personaDefaultOption">Santai & Bercanda</option>
                    <option value="creative" id="personaCreativeOption">Kreatif & Ekspresif</option>
                </select>
            </div>

            <h3 id="settingsApiTitle">Kunci API Google</h3>
            <div class="settings-option">
                <p id="settingsApiText">Masukkan Kunci API kustom Anda:</p>
                <div class="api-key-container">
                    <input type="password" id="apiKeyInput">
                    <i class="fas fa-eye" id="toggleApiKey"></i>
                </div>
                <button id="saveApiBtn" class="settings-credits-btn">Simpan</button>
            </div>

            <h3 id="settingsBackupTitle">Backup & Restore</h3>
            <div class="settings-option" style="flex-direction: column; align-items: flex-start; gap: 10px;">
                <p style="font-size: 0.8em; color: #aaa;" id="backupDescText">Save or move your chat history via JSON file.</p>
                <div style="display: flex; gap: 10px; width: 100%;">
                    <button id="exportBtn" class="settings-credits-btn" style="flex: 1; background: #28a745;">
                        <i class="fas fa-download"></i> Export
                    </button>
                    <button id="importBtn" class="settings-credits-btn" style="flex: 1; background: #ffc107; color: #000;">
                        <i class="fas fa-upload"></i> Import
                    </button>
                </div>
                <input type="file" id="importFileInput" accept=".json" style="display: none;">
            </div>
            
            <h3 id="settingsAboutTitle"></h3>
            <div class="settings-about">
                <p id="settingsAuthorText"></p>
                <p><a href="https://allwaysevermirai.netlify.app/about" target="_blank" id="githubLink"><i class="fas fa-info-circle"></i></a></p>
                <p><a href="https://github.com/Allwaysever/MirAI/blob/main/LICENSE" id="licenseLink" target="_blank"></a></p>
                <p><a href="help/index.html" id="helpLink" target="_self"></a></p>
                <div class="gemini-container">
                    <a href="https://deepmind.google/models/gemini/flash/" target="_blank">
                        <img src="https://raw.githubusercontent.com/Allwaysever/MirAI/refs/heads/main/Assets/Gemini%202.5%20Flash%20Logo.png" alt="Google Gemini 2.5 Flash" class="gemini-logo">
                    </a>
                </div>
                <p id="termsText"></p>
            </div>
        </div>
    </div>
</div>


<div id="customConfirmOverlay">

    <div id="customConfirmBox">

        <p id="customConfirmMessage"></p>

        <div class="custom-confirm-buttons">

            <button id="confirmBtnYes"></button>

            <button id="confirmBtnNo"></button>

        </div>

    </div>

</div>

<script>
    const DEFAULT_API_KEY = 'AIzaSyBclOlr7UNm1Leoj83fB9uJR7Jt6qQRphA';

    let currentApiKey = DEFAULT_API_KEY; 

// [PEMBARUAN] Deteksi model dan mode PWA berdasarkan parameter URL
const urlParams = new URLSearchParams(window.location.search);
const isBeta = urlParams.has('betamodel');
const isPWA = urlParams.has('pwa'); // Tambahkan ini bro

// Jika ada ?betamodel di URL, pakai seri 3, jika tidak pakai 2.5
const model = isBeta ? 'gemini-3-flash-preview' : 'gemini-2.5-flash';

console.log(`Mode yang aktif: ${isBeta ? 'Beta (3 Kilat)' : 'Stabil (2.5 Kilat)'}`);

    const faqDatabase = {

        "changelog": "# Changelog\n\n Check this project's [github repository](https://github.com/Allwaysever/MirAI/blob/main/CHANGELOG.md) for changelogs information.",

        "donate": "# Donate\n\n Please donate to add features and improve AI capabilities. [Buy us a DiamondStars](https://trakteer.id/Allwaysever)"

    };

 const uiStrings = {

        'id': {

            offlineTitle: 'Koneksi Internet Terputus',

            offlineText: 'Silakan periksa koneksi WiFi atau data seluler Anda, lalu coba kembali.',

            retryButton: 'Coba Lagi',

            inputPlaceholder: 'Ketik pertanyaan Anda di sini...',

            copyFeedback: 'Teks berhasil disalin!',

            langSwitchFeedback: 'Bahasa telah diubah ke',

            errorAPI: 'Terjadi kesalahan. Silakan muat ulang atau coba beberapa saat lagi.\n\nHmm... sepertinya kunci API ini telah terkena batas penggunaan. Jika Anda masih menggunakan kunci API bawaan, mohon segera ganti dengan kunci API pribadi Anda. Silakan cek tutorialnya di [Halaman GitHub MirAI](https://github.com/Allwaysever/MirAI?tab=readme-ov-file#%EF%B8%8F-setup-using-your-own-api-key).',

            errorFallback: 'Maaf, jawaban tidak ditemukan. Coba gunakan kata kunci yang berbeda.',

            errorConnection: 'Koneksi internet tidak tersedia. Mohon periksa kembali.',

            checkingConnection: 'Memeriksa koneksi internet...',

            copySuffix: '\n\n-- Dihasilkan oleh MirAI',

            infoText: 'Informasi yang dihasilkan AI mungkin tidak akurat. Verifikasi kembali fakta penting.',

            settingsHeaderTitle: 'Pengaturan',

            settingsAppearanceTitle: 'Tampilan',

            settingsThemeText: 'Pilih preferensi tema Anda:',

            themeLightOption: 'Terang',

            themeDarkOption: 'Gelap',

            settingsAITitle: 'Persona AI',

            settingsPersonaText: 'Pilih gaya respons AI:',

            personaFormalOption: 'Formal & Profesional',

            personaDefaultOption: 'Santai & Bercanda',

            personaCreativeOption: 'Kreatif & Ekspresif',

            settingsAboutTitle: 'Tentang Aplikasi',

            settingsVersionText: `Versi: v${VERSION}`,

            settingsAuthorText: 'Dikembangkan oleh Allwaysever',

            githubLink: 'Tentang MirAI',

            licenseLink: 'Lisensi',

            helpLink: 'Pusat Bantuan',

            termsText: 'Dengan menggunakan MirAI, Anda menyetujui <a href="T&C/index.html" target="_blank">Syarat & Ketentuan</a>.',

            personaDefaultPrompt: 'Anda adalah MirAI, asisten AI yang santai dan suka bercanda. Jawab semua pertanyaan dengan gaya yang ramah, sedikit humor, namun tetap informatif.',

            personaFormalPrompt: 'Anda adalah MirAI, asisten AI profesional. Berikan jawaban yang terstruktur, akurat, dan menggunakan bahasa formal.',

            personaCreativePrompt: 'Anda adalah MirAI, asisten AI yang kreatif. Berikan jawaban yang unik, imajinatif, dan ekspresif untuk setiap pertanyaan.',

            placeholderMessages: ['Ajukan pertanyaan apa pun.', 'Butuh bantuan untuk ide?', 'Minta terjemahan atau ringkasan.', 'Bagaimana saya bisa membantu?'],

            onlineStatus: 'Terhubung',

            offlineStatus: 'Terputus',

            settingsApiTitle: 'Kunci API Google',

            settingsApiText: 'Masukkan Kunci API kustom Anda:',

            apiKeySaved: 'Kunci API berhasil disimpan.',

            apiKeyRemoved: 'Kunci API dihapus. Menggunakan kunci default.',

            dateTimeContextPrompt: '[{dateTime}]:',

            confirmClearMessage: 'Apakah Anda yakin ingin menghapus riwayat percakapan ini? Tindakan ini tidak dapat diurungkan.',

            confirmClearYes: 'Ya, Hapus',

            confirmClearNo: 'Batal',

            pageTitle: 'MirAI | Asisten AI Anda',

            saveApiKeyBtn: 'Simpan',

            apiKeyPlaceholder: 'Kosongkan untuk menggunakan kunci default',

    // Dari HTML settings section:
    'settingsBackupTitle': 'Backup & Pulihkan', // Sudah ada di request sebelumnya
    
    // Dari backup description di HTML:
    'backupDescText': 'Simpan atau pindahkan riwayat chat kamu lewat file JSON.',
    
    // Dari export/import button text di HTML:
    'exportBtnText': 'Export', // Ini teks tombol di HTML
    'importBtnText': 'Import', // Ini teks tombol di HTML
    
    // Untuk teks konfirmasi import yang muncul di alert:
    'importSuccessText': 'Backup berhasil dipulihkan! Aplikasi akan dimuat ulang.',
    'importErrorText': 'Waduh, filenya rusak atau bukan format backup MirAI! ğŸ—¿',
    
    // Untuk Install PWA button (ada di script PWA):
    'installBtnText': 'Install App', // Teks tombol install
    
    // Untuk image upload (error alert):
    'invalidImageText': 'Silakan unggah file gambar (jpeg, png, webp).',
    
    // Untuk beta mode indicator (di splash screen):
    'betaModelActive': '#3FlashPreviewMode', // Sudah ada
    
    // Untuk slash commands description (di tools menu):
    'slashCmdSearchTitle': 'Cari',
    'slashCmdSearchDesc': '/search [kata kunci pencarian]',
    'slashCmdTranslateTitle': 'Terjemahkan',
    'slashCmdTranslateDesc': '/translate [teks] to [bahasa]',
    'slashCmdSummarizeTitle': 'Ringkas',
    'slashCmdSummarizeDesc': '/summarize [teks panjang]',
    'slashCmdRephraseTitle': 'Ubah Kalimat',
    'slashCmdRephraseDesc': '/rephrase [teks] as [gaya]',
    'slashCmdIdeateTitle': 'Buat Ide',
    'slashCmdIdeateDesc': '/ideate [jumlah] ideas for [topik]',
    'slashCmdFixTitle': 'Perbaiki',
    'slashCmdFixDesc': '/fix [teks yang perlu diperbaiki]',
    'slashCmdExplainTitle': 'Jelaskan',
    'slashCmdExplainDesc': '/explain [konsep] like I\'m [audiens]',
    'slashCmdCodeTitle': 'Buat Kode',
    'slashCmdCodeDesc': '/code a [bahasa pemrograman] function to [deskripsi]',
    
    // Untuk error messages slash commands (muncul di chat):
    'slashErrorInvalidFormat': 'Error: Format tidak valid.',
    'slashErrorInvalidFormatTranslate': 'Error: Format tidak valid. Gunakan /translate [teks] to [bahasa]',
    'slashErrorInvalidFormatRephrase': 'Error: Format tidak valid. Gunakan /rephrase [teks] as [gaya]',
    'slashErrorInvalidFormatIdeate': 'Error: Format tidak valid. Gunakan /ideate [jumlah] ideas for [topik]',
    'slashErrorInvalidFormatExplain': 'Error: Format tidak valid. Gunakan /explain [konsep] like I\'m [audiens]',
    'slashErrorInvalidFormatCode': 'Error: Format tidak valid. Gunakan /code a [bahasa] function to [deskripsi]',
    'slashErrorInvalidFormatSearch': 'Error: Format tidak valid. Gunakan /search [kata kunci]',
    'slashErrorUnknownCommand': 'Error: Perintah tidak dikenal.',
    
    // Untuk button di custom confirm (clear chat):
    'confirmBtnYes': 'Ya, Hapus', // Sudah ada
    'confirmBtnNo': 'Batal', // Sudah ada
    
    // Untuk feedback copy (muncul sebagai toast):
    'copyFeedback': 'Teks berhasil disalin!', // Sudah ada
    
    // Untuk teks placeholder saat PWA sudah terinstall:
    'pwaInstalledText': 'PWA was installed successfully!', // Teks di console.log
    
    // Untuk alert saat API limit:
    'apiLimitError': 'Hmm... sepertinya kunci API ini telah terkena batas penggunaan. Jika Anda masih menggunakan kunci API bawaan, mohon segera ganti dengan kunci API pribadi Anda.'
},

        'en': {

            offlineTitle: 'Internet Connection Lost',

            offlineText: 'Please check your WiFi or cellular data connection, then try again.',

            retryButton: 'Retry',

            inputPlaceholder: 'Type your question here...',

            copyFeedback: 'Text copied to clipboard!',

            langSwitchFeedback: 'Language has been changed to',

            errorAPI: 'An error occurred. Please reload the page or try again shortly.\n\nHmm... it seems that this API key has reached its usage limit. If you are still using the default API key, please replace it with your personal API key immediately. Please check the tutorial on the [MirAI GitHub page](https://github.com/Allwaysever/MirAI?tab=readme-ov-file#%EF%B8%8F-setup-using-your-own-api-key).',

            errorFallback: 'Sorry, no answer was found. Please try different keywords.',

            errorConnection: 'Internet connection is unavailable. Please check and try again.',

            checkingConnection: 'Checking internet connection...',

            copySuffix: '\n\n-- Generated by MirAI',

            infoText: 'AI-generated information may be inaccurate. Please verify important facts.',

            settingsHeaderTitle: 'Settings',

            settingsAppearanceTitle: 'Appearance',

            settingsThemeText: 'Select your theme preference:',

            themeLightOption: 'Light',

            themeDarkOption: 'Dark',

            settingsAITitle: 'AI Persona',

            settingsPersonaText: 'Choose the AI\'s response style:',

            personaFormalOption: 'Formal & Professional',

            personaDefaultOption: 'Chill & joking',

            personaCreativeOption: 'Creative & Expressive',

            settingsAboutTitle: 'About',

            settingsVersionText: `Version: v${VERSION}`,

            settingsAuthorText: 'Developed by Allwaysever',

            githubLink: 'About MirAI',

            licenseLink: 'License',

            helpLink: 'Help Center',

            termsText: 'By using MirAI, you agree to the <a href="T&C/index.html" target="_blank">Terms & Conditions</a>.',

            personaDefaultPrompt: 'You are MirAI, a relaxed and humorous AI assistant. Answer all questions in a friendly style, with a bit of humor, while remaining informative.',

            personaFormalPrompt: 'You are MirAI, a professional AI assistant. Provide well-structured, accurate, and formal responses.',

            personaCreativePrompt: 'You are MirAI, a creative AI assistant. Provide unique, imaginative, and expressive answers to every query.',

            placeholderMessages: ['Ask any question.', 'Need help with an idea?', 'Request a translation or summary.', 'How can I assist you?'],

            onlineStatus: 'Connected',

            offlineStatus: 'Disconnected',

            settingsApiTitle: 'Google API Key',

            settingsApiText: 'Enter your custom API Key:',

            apiKeySaved: 'API Key saved successfully.',

            apiKeyRemoved: 'API Key removed. Using default key.',

            dateTimeContextPrompt: '[{dateTime}]:',

            confirmClearMessage: 'Are you sure you want to delete this chat history? This action cannot be undone.',

            confirmClearYes: 'Yes, Delete',

            confirmClearNo: 'Cancel',

            pageTitle: 'MirAI | Your AI Assistant',

            saveApiKeyBtn: 'Save',

            apiKeyPlaceholder: 'Leave blank to use the default key',

  
    // Backup & Restore
    'settingsBackupTitle': 'Backup & Restore',
    'backupDescText': 'Save or transfer your chat history via JSON file.',
    'exportBtnText': 'Export',
    'importBtnText': 'Import',
    'importSuccessText': 'Backup restored successfully! App will reload.',
    'importErrorText': 'File corrupted or not a MirAI backup! ğŸ—¿',
    
    // Install PWA
    'installBtnText': 'Install App',
    
    // Image upload
    'invalidImageText': 'Please upload an image file (jpeg, png, webp).',
    
    // Beta mode
    'betaModelActive': '#3FlashPreviewMode',
    
    // Slash commands
    'slashCmdSearchTitle': 'Search',
    'slashCmdSearchDesc': '/search [search query]',
    'slashCmdTranslateTitle': 'Translate',
    'slashCmdTranslateDesc': '/translate [text] to [language]',
    'slashCmdSummarizeTitle': 'Summarize',
    'slashCmdSummarizeDesc': '/summarize [long text]',
    'slashCmdRephraseTitle': 'Rephrase',
    'slashCmdRephraseDesc': '/rephrase [text] as [tone]',
    'slashCmdIdeateTitle': 'Ideate',
    'slashCmdIdeateDesc': '/ideate [amount] ideas for [topic]',
    'slashCmdFixTitle': 'Fix',
    'slashCmdFixDesc': '/fix [text that needs to be corrected]',
    'slashCmdExplainTitle': 'Explain',
    'slashCmdExplainDesc': '/explain [concept] like I\'m [audience]',
    'slashCmdCodeTitle': 'Code',
    'slashCmdCodeDesc': '/code a [programming language] function to [description]',
    
    // Slash command errors
    'slashErrorInvalidFormat': 'Error: Invalid format.',
    'slashErrorInvalidFormatTranslate': 'Error: Invalid format. Use /translate [text] to [language]',
    'slashErrorInvalidFormatRephrase': 'Error: Invalid format. Use /rephrase [text] as [tone]',
    'slashErrorInvalidFormatIdeate': 'Error: Invalid format. Use /ideate [number] ideas for [topic]',
    'slashErrorInvalidFormatExplain': 'Error: Invalid format. Use /explain [concept] like I\'m [audience]',
    'slashErrorInvalidFormatCode': 'Error: Invalid format. Use /code a [language] function to [description]',
    'slashErrorInvalidFormatSearch': 'Error: Invalid format. Use /search [query]',
    'slashErrorUnknownCommand': 'Error: Unknown command.',
    
    // Confirm buttons
    'confirmBtnYes': 'Yes, Delete',
    'confirmBtnNo': 'Cancel',
    
    // Copy feedback
    'copyFeedback': 'Text copied to clipboard!',
    
    // PWA installed
    'pwaInstalledText': 'PWA was installed successfully!',
    
    // API limit error
    'apiLimitError': 'Hmm... it seems that this API key has reached its usage limit. If you are still using the default API key, please replace it with your personal API key immediately.'
},

        'en-uk': {

            offlineTitle: 'Internet Connection Lost',

            offlineText: 'Please check your WiFi or cellular data connection, then try again.',

            retryButton: 'Retry',

            inputPlaceholder: 'Type your question here...',

            copyFeedback: 'Text copied to clipboard!',

            langSwitchFeedback: 'Language has been changed to',

            errorAPI: 'An error occurred. Please reload the page or try again shortly.\n\nHmm... it appears that this API key has reached its usage limit. If you are still using the default API key, please replace it with your personal API key immediately. Please check the tutorial on the [MirAI GitHub page](https://github.com/Allwaysever/MirAI?tab=readme-ov-file#%EF%B8%8F-setup-using-your-own-api-key).',

            errorFallback: 'Sorry, no answer was found. Please try different keywords.',

            errorConnection: 'Internet connection is unavailable. Please check and try again.',

            checkingConnection: 'Checking internet connection...',

            copySuffix: '\n\n-- Generated by MirAI',

            infoText: 'AI-generated information may be inaccurate. Please verify important facts.',

            settingsHeaderTitle: 'Settings',

            settingsAppearanceTitle: 'Appearance',

            settingsThemeText: 'Select your theme preference:',

            themeLightOption: 'Light',

            themeDarkOption: 'Dark',

            settingsAITitle: 'AI Persona',

            settingsPersonaText: 'Choose the AI\'s response style:',

            personaFormalOption: 'Formal & Professional',

            personaDefaultOption: 'Laid-back & bantering',

            personaCreativeOption: 'Creative & Expressive',

            settingsAboutTitle: 'About',

            settingsVersionText: `Version: v${VERSION}`,

            settingsAuthorText: 'Developed by Allwaysever',

            githubLink: 'About MirAI',

            licenseLink: 'License',

            helpLink: 'Help Center',

            termsText: 'By using MirAI, you agree to the <a href="T&C/index.html" target="_blank">Terms & Conditions</a>.',

            personaDefaultPrompt: 'You are MirAI, a relaxed and humorous AI assistant. Answer all questions in a friendly style, with a bit of humour, while remaining informative.',

            personaFormalPrompt: 'You are MirAI, a professional AI assistant. Provide well-structured, accurate, and formal responses.',

            personaCreativePrompt: 'You are MirAI, a creative AI assistant. Provide unique, imaginative, and expressive answers to every query.',

            placeholderMessages: ['Ask any question.', 'Need help with an idea?', 'Request a translation or summary.', 'How can I assist you?'],

            onlineStatus: 'Connected',

            offlineStatus: 'Disconnected',

            settingsApiTitle: 'Google API Key',

            settingsApiText: 'Enter your custom API Key:',

            apiKeySaved: 'API Key saved successfully.',

            apiKeyRemoved: 'API Key removed. Using default key.',

            dateTimeContextPrompt: '[{dateTime}]:',

            confirmClearMessage: 'Are you sure you want to delete this chat history? This action cannot be undone.',

            confirmClearYes: 'Yes, Delete',

            confirmClearNo: 'Cancel',

            pageTitle: 'MirAI | Your AI Assistant',

            saveApiKeyBtn: 'Save',

            apiKeyPlaceholder: 'Leave blank to use the default key',

  
    // Backup & Restore
    'settingsBackupTitle': 'Backup & Restore',
    'backupDescText': 'Save or transfer your chat history via JSON file.',
    'exportBtnText': 'Export',
    'importBtnText': 'Import',
    'importSuccessText': 'Backup restored successfully! App will reload.',
    'importErrorText': 'File corrupted or not a MirAI backup! ğŸ—¿',
    
    // Install PWA
    'installBtnText': 'Install App',
    
    // Image upload
    'invalidImageText': 'Please upload an image file (jpeg, png, webp).',
    
    // Beta mode
    'betaModelActive': '#3FlashPreviewMode',
    
    // Slash commands
    'slashCmdSearchTitle': 'Search',
    'slashCmdSearchDesc': '/search [search query]',
    'slashCmdTranslateTitle': 'Translate',
    'slashCmdTranslateDesc': '/translate [text] to [language]',
    'slashCmdSummarizeTitle': 'Summarize',
    'slashCmdSummarizeDesc': '/summarize [long text]',
    'slashCmdRephraseTitle': 'Rephrase',
    'slashCmdRephraseDesc': '/rephrase [text] as [tone]',
    'slashCmdIdeateTitle': 'Ideate',
    'slashCmdIdeateDesc': '/ideate [amount] ideas for [topic]',
    'slashCmdFixTitle': 'Fix',
    'slashCmdFixDesc': '/fix [text that needs to be corrected]',
    'slashCmdExplainTitle': 'Explain',
    'slashCmdExplainDesc': '/explain [concept] like I\'m [audience]',
    'slashCmdCodeTitle': 'Code',
    'slashCmdCodeDesc': '/code a [programming language] function to [description]',
    
    // Slash command errors
    'slashErrorInvalidFormat': 'Error: Invalid format.',
    'slashErrorInvalidFormatTranslate': 'Error: Invalid format. Use /translate [text] to [language]',
    'slashErrorInvalidFormatRephrase': 'Error: Invalid format. Use /rephrase [text] as [tone]',
    'slashErrorInvalidFormatIdeate': 'Error: Invalid format. Use /ideate [number] ideas for [topic]',
    'slashErrorInvalidFormatExplain': 'Error: Invalid format. Use /explain [concept] like I\'m [audience]',
    'slashErrorInvalidFormatCode': 'Error: Invalid format. Use /code a [language] function to [description]',
    'slashErrorInvalidFormatSearch': 'Error: Invalid format. Use /search [query]',
    'slashErrorUnknownCommand': 'Error: Unknown command.',
    
    // Confirm buttons
    'confirmBtnYes': 'Yes, Delete',
    'confirmBtnNo': 'Cancel',
    
    // Copy feedback
    'copyFeedback': 'Text copied to clipboard!',
    
    // PWA installed
    'pwaInstalledText': 'PWA was installed successfully!',
    
    // API limit error
    'apiLimitError': 'Hmm... it seems that this API key has reached its usage limit. If you are still using the default API key, please replace it with your personal API key immediately.'
},

        'jp': {

            offlineTitle: 'ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šãŒã‚ã‚Šã¾ã›ã‚“',

            offlineText: 'WiFiã¾ãŸã¯ãƒ‡ãƒ¼ã‚¿æ¥ç¶šã‚’ç¢ºèªã—ã€å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚',

            retryButton: 'å†è©¦è¡Œ',

            inputPlaceholder: 'ã“ã“ã«è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...',

            copyFeedback: 'ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚',

            langSwitchFeedback: 'è¨€èªãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸ',

            errorAPI: 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã™ã‚‹ã‹ã€ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚\n\nHmm... ã“ã®APIã‚­ãƒ¼ã¯ä½¿ç”¨åˆ¶é™ã«é”ã—ãŸã‚ˆã†ã§ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®APIã‚­ãƒ¼ã‚’ã¾ã ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€ã™ãã«å€‹äººç”¨ã®APIã‚­ãƒ¼ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚è©³ç´°ãªæ‰‹é †ã¯[MirAIã®GitHubãƒšãƒ¼ã‚¸](https://github.com/Allwaysever/MirAI?tab=readme-ov-file#%EF%B8%8F-setup-using-your-own-api-key)ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’ã”ç¢ºèªãã ã•ã„ã€‚',

            errorFallback: 'ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€å›ç­”ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚åˆ¥ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§ãŠè©¦ã—ãã ã•ã„ã€‚',

            errorConnection: 'ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«æ¥ç¶šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚',

            checkingConnection: 'ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªä¸­...',

            copySuffix: '\n\n-- MirAIã«ã‚ˆã£ã¦ç”Ÿæˆ',

            infoText: 'AIãŒç”Ÿæˆã—ãŸæƒ…å ±ã¯ä¸æ­£ç¢ºãªå ´åˆãŒã‚ã‚Šã¾ã™ã€‚é‡è¦ãªäº‹å®Ÿã¯å†åº¦ã”ç¢ºèªãã ã•ã„ã€‚',

            settingsHeaderTitle: 'è¨­å®š',

            settingsAppearanceTitle: 'å¤–è¦³',

            settingsThemeText: 'ãƒ†ãƒ¼ãƒã‚’é¸æŠã—ã¦ãã ã•ã„:',

            themeLightOption: 'ãƒ©ã‚¤ãƒˆ',

            themeDarkOption: 'ãƒ€ãƒ¼ã‚¯',

            settingsAITitle: 'AIã®ãƒšãƒ«ã‚½ãƒŠ',

            settingsPersonaText: 'AIã®å¿œç­”ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é¸æŠ:',

            personaFormalOption: 'ãƒ•ã‚©ãƒ¼ãƒãƒ«ãƒ»ãƒ—ãƒ­',

            personaDefaultOption: 'ã®ã‚“ã³ã‚Šã—ã¦ã¦å†—è«‡å¥½ã',

            personaCreativeOption: 'ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãƒ»è¡¨ç¾è±Šã‹',

            settingsAboutTitle: 'ã‚¢ãƒ—ãƒªã«ã¤ã„ã¦',

            settingsVersionText: `ãƒãƒ¼ã‚¸ãƒ§ãƒ³: v${VERSION}`,

            settingsAuthorText: 'é–‹ç™ºè€…: Allwaysever',

            githubLink: 'MirAIã«ã¤ã„ã¦',

            licenseLink: 'ãƒ©ã‚¤ã‚»ãƒ³ã‚¹',

            helpLink: 'ãƒ˜ãƒ«ãƒ—ã‚»ãƒ³ã‚¿ãƒ¼',

            termsText: 'MirAIã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€<a href="T&C/index.html" target="_blank">åˆ©ç”¨è¦ç´„</a>ã«åŒæ„ã—ãŸã“ã¨ã«ãªã‚Šã¾ã™ã€‚',

            personaDefaultPrompt: 'ã‚ãªãŸã¯MirAIã€ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ã¦å†—è«‡å¥½ããªAIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªã‚¹ã‚¿ã‚¤ãƒ«ã§ã€å°‘ã—ãƒ¦ãƒ¼ãƒ¢ã‚¢ã‚’äº¤ãˆãªãŒã‚‰ã‚‚ã€æƒ…å ±ã‚’æä¾›ã™ã‚‹ã‚ˆã†ã«ã™ã¹ã¦ã®è³ªå•ã«ç­”ãˆã¦ãã ã•ã„ã€‚',

            personaFormalPrompt: 'ã‚ãªãŸã¯MirAIã€ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªAIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚æ§‹é€ åŒ–ã•ã‚Œã€æ­£ç¢ºã§ã€ãƒ•ã‚©ãƒ¼ãƒãƒ«ãªè¨€è‘‰é£ã„ã§å›ç­”ã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚',

            personaCreativePrompt: 'ã‚ãªãŸã¯MirAIã€å‰µé€ çš„ãªAIã‚¢ã‚·ã‚¹ã‚¿NTã§ã™ã€‚ã™ã¹ã¦ã®è³ªå•ã«å¯¾ã—ã¦ã€ãƒ¦ãƒ‹ãƒ¼ã‚¯ã§æƒ³åƒåŠ›ã«å¯Œã‚“ã è¡¨ç¾åŠ›è±Šã‹ãªå›ç­”ã‚’ã—ã¦ãã ã•ã„ã€‚',

            placeholderMessages: ['è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', 'ã‚¢ã‚¤ãƒ‡ã‚¢ãŒå¿…è¦ã§ã™ã‹ï¼Ÿ', 'ç¿»è¨³ã¾ãŸã¯è¦ç´„ã‚’ä¾é ¼ã€‚', 'ä½•ã‹ãŠæ‰‹ä¼ã„ã§ãã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ'],

            onlineStatus: 'æ¥ç¶šæ¸ˆã¿',

            offlineStatus: 'åˆ‡æ–­',

            settingsApiTitle: 'Google APIã‚­ãƒ¼',

            settingsApiText: 'ã‚«ã‚¹ã‚¿ãƒ APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:',

            apiKeySaved: 'APIã‚­ãƒ¼ãŒä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚',

            apiKeyRemoved: 'APIã‚­ãƒ¼ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚­ãƒ¼ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚',

            dateTimeContextPrompt: '[{dateTime}]:',

            confirmClearMessage: 'ã“ã®ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚',

            confirmClearYes: 'ã¯ã„ã€å‰Šé™¤ã—ã¾ã™',

            confirmClearNo: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«',

            pageTitle: 'MirAI | AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ',

            saveApiKeyBtn: 'ä¿å­˜',

            apiKeyPlaceholder: 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚­ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ç©ºæ¬„',

    // Backup & Restore
    'settingsBackupTitle': 'ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨å¾©å…ƒ',
    'backupDescText': 'JSONãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚’ä¿å­˜ã¾ãŸã¯è»¢é€ã—ã¾ã™ã€‚',
    'exportBtnText': 'ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ',
    'importBtnText': 'ã‚¤ãƒ³ãƒãƒ¼ãƒˆ',
    'importSuccessText': 'ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒæ­£å¸¸ã«å¾©å…ƒã•ã‚Œã¾ã—ãŸï¼ã‚¢ãƒ—ãƒªã‚’å†èª­ã¿è¾¼ã¿ã—ã¾ã™ã€‚',
    'importErrorText': 'ãƒ•ã‚¡ã‚¤ãƒ«ãŒå£Šã‚Œã¦ã„ã‚‹ã‹ã€MirAIã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å½¢å¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ğŸ—¿',
    
    // Install PWA
    'installBtnText': 'ã‚¢ãƒ—ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«',
    
    // Image upload
    'invalidImageText': 'ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆJPEGã€PNGã€WebPï¼‰ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚',
    
    // Beta mode
    'betaModelActive': '#3Flashãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰',
    
    // Slash commands
    'slashCmdSearchTitle': 'æ¤œç´¢',
    'slashCmdSearchDesc': '/search [æ¤œç´¢ã‚¯ã‚¨ãƒª]',
    'slashCmdTranslateTitle': 'ç¿»è¨³',
    'slashCmdTranslateDesc': '/translate [ãƒ†ã‚­ã‚¹ãƒˆ] to [è¨€èª]',
    'slashCmdSummarizeTitle': 'è¦ç´„',
    'slashCmdSummarizeDesc': '/summarize [é•·ã„ãƒ†ã‚­ã‚¹ãƒˆ]',
    'slashCmdRephraseTitle': 'è¨€ã„æ›ãˆ',
    'slashCmdRephraseDesc': '/rephrase [ãƒ†ã‚­ã‚¹ãƒˆ] as [å£èª¿]',
    'slashCmdIdeateTitle': 'ã‚¢ã‚¤ãƒ‡ã‚¢ç”Ÿæˆ',
    'slashCmdIdeateDesc': '/ideate [æ•°] ideas for [ãƒˆãƒ”ãƒƒã‚¯]',
    'slashCmdFixTitle': 'ä¿®æ­£',
    'slashCmdFixDesc': '/fix [ä¿®æ­£ãŒå¿…è¦ãªãƒ†ã‚­ã‚¹ãƒˆ]',
    'slashCmdExplainTitle': 'èª¬æ˜',
    'slashCmdExplainDesc': '/explain [æ¦‚å¿µ] like I\'m [å¯¾è±¡]',
    'slashCmdCodeTitle': 'ã‚³ãƒ¼ãƒ‰',
    'slashCmdCodeDesc': '/code a [ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èª] function to [èª¬æ˜]',
    
    // Slash command errors
    'slashErrorInvalidFormat': 'ã‚¨ãƒ©ãƒ¼: å½¢å¼ãŒç„¡åŠ¹ã§ã™ã€‚',
    'slashErrorInvalidFormatTranslate': 'ã‚¨ãƒ©ãƒ¼: å½¢å¼ãŒç„¡åŠ¹ã§ã™ã€‚ /translate [ãƒ†ã‚­ã‚¹ãƒˆ] to [è¨€èª] ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„',
    'slashErrorInvalidFormatRephrase': 'ã‚¨ãƒ©ãƒ¼: å½¢å¼ãŒç„¡åŠ¹ã§ã™ã€‚ /rephrase [ãƒ†ã‚­ã‚¹ãƒˆ] as [å£èª¿] ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„',
    'slashErrorInvalidFormatIdeate': 'ã‚¨ãƒ©ãƒ¼: å½¢å¼ãŒç„¡åŠ¹ã§ã™ã€‚ /ideate [æ•°] ideas for [ãƒˆãƒ”ãƒƒã‚¯] ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„',
    'slashErrorInvalidFormatExplain': 'ã‚¨ãƒ©ãƒ¼: å½¢å¼ãŒç„¡åŠ¹ã§ã™ã€‚ /explain [æ¦‚å¿µ] like I\'m [å¯¾è±¡] ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„',
    'slashErrorInvalidFormatCode': 'ã‚¨ãƒ©ãƒ¼: å½¢å¼ãŒç„¡åŠ¹ã§ã™ã€‚ /code a [è¨€èª] function to [èª¬æ˜] ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„',
    'slashErrorInvalidFormatSearch': 'ã‚¨ãƒ©ãƒ¼: å½¢å¼ãŒç„¡åŠ¹ã§ã™ã€‚ /search [ã‚¯ã‚¨ãƒª] ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„',
    'slashErrorUnknownCommand': 'ã‚¨ãƒ©ãƒ¼: ä¸æ˜ãªã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚',
    
    // Confirm buttons
    'confirmBtnYes': 'ã¯ã„ã€å‰Šé™¤ã—ã¾ã™',
    'confirmBtnNo': 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«',
    
    // Copy feedback
    'copyFeedback': 'ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚',
    
    // PWA installed
    'pwaInstalledText': 'PWAãŒæ­£å¸¸ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã—ãŸï¼',
    
    // API limit error
    'apiLimitError': 'ã“ã®APIã‚­ãƒ¼ã¯ä½¿ç”¨åˆ¶é™ã«é”ã—ãŸã‚ˆã†ã§ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®APIã‚­ãƒ¼ã‚’ã¾ã ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€ã™ãã«å€‹äººç”¨ã®APIã‚­ãƒ¼ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚'
}

    };

    let slashCommands = [];

    let chatHistory = [];

    let abortController = null;

    let currentLanguage = 'en';

    let currentPersona = 'default';

    let currentImageData = null;



    // [FIX] Deklarasikan `elements` di scope global tapi jangan diisi dulu

    let elements;



    // --- Semua deklarasi fungsi ditaruh di sini (global scope) ---

    // DEBUG FUNCTION untuk cek settings scroll
function debugSettingsScroll() {
    console.log("=== DEBUG SETTINGS SCROLL ===");
    
    const settingsPage = document.getElementById('settingsPage');
    const scrollContainer = document.querySelector('.settings-scroll-container');
    const content = document.querySelector('.settings-content');
    
    if (settingsPage) {
        console.log("Settings Page Found:", settingsPage);
        console.log("Display:", window.getComputedStyle(settingsPage).display);
        console.log("Height:", settingsPage.offsetHeight, "px");
    }
    
    if (scrollContainer) {
        console.log("Scroll Container Found:", scrollContainer);
        console.log("Scroll Height:", scrollContainer.scrollHeight, "px");
        console.log("Client Height:", scrollContainer.clientHeight, "px");
        console.log("Overflow-Y:", window.getComputedStyle(scrollContainer).overflowY);
        console.log("Can Scroll?", scrollContainer.scrollHeight > scrollContainer.clientHeight);
    }
    
    if (content) {
        console.log("Content Height:", content.offsetHeight, "px");
    }
    
    console.log("Window Height:", window.innerHeight, "px");
    console.log("Body Height:", document.body.offsetHeight, "px");
    console.log("=== END DEBUG ===");
}

// Panggil debug saat settings dibuka
function showSettingsPage() {
    elements.settingsPage.classList.add('active');
    document.body.classList.add('settings-open');
    document.body.style.overflow = 'hidden';
    
    // Debug setelah dibuka
    setTimeout(debugSettingsScroll, 100);
}

// Panggil debug saat settings ditutup
function hideSettingsPage() {
    elements.settingsPage.classList.remove('active');
    document.body.classList.remove('settings-open');
    document.body.style.overflow = '';
}


    function initializeSlashCommands(lang) {

        const s = uiStrings[lang];

        slashCommands = [

            { command: '/search', title: s.slashCmdSearchTitle, description: '/search [search query]' },

            { command: '/translate', title: s.slashCmdTranslateTitle, description: '/translate [text] to [language]' },

            { command: '/summarize', title: s.slashCmdSummarizeTitle, description: '/summarize [long text]' },

            { command: '/rephrase', title: s.slashCmdRephraseTitle, description: '/rephrase [text] as [tone]' },

            { command: '/ideate', title: s.slashCmdIdeateTitle, description: '/ideate [amount] ideas for [topic]' },

            { command: '/fix', title: s.slashCmdFixTitle, description: '/fix [text that needs to be corrected]' },

            { command: '/explain', title: s.slashCmdExplainTitle, description: '/explain [concept] like I\'m [audience]' },

            { command: '/code', title: s.slashCmdCodeTitle, description: '/code a [programming language] function to [description]' }

        ];

    }



// [BARU] Fungsi untuk konversi gambar ke Base64

    function convertImageToBase64(file) {

        return new Promise((resolve, reject) => {

            const reader = new FileReader();

            reader.readAsDataURL(file);

            reader.onload = () => {

                // Hapus prefix "data:image/jpeg;base64,"

                const base64String = reader.result.split(',')[1];

                resolve(base64String);

            };

            reader.onerror = error => reject(error);

        });

    }



    // [BARU] Fungsi untuk menangani upload gambar

    function handleImageUpload(event) {

        const file = event.target.files[0];

        if (!file) return;



        if (!file.type.startsWith('image/')) {

            alert('Silakan unggah file gambar (jpeg, png, webp).');

            return;

        }



        elements.imageInput.value = ''; // Reset input agar bisa upload gambar yang sama



        convertImageToBase64(file)

            .then(base64Data => {

                currentImageData = {

                    mimeType: file.type,

                    data: base64Data

                };

                

                elements.imagePreview.src = `data:${file.type};base64,${base64Data}`;

                elements.imagePreviewContainer.style.display = 'flex'; // <--- UBAH DI SINI

                toggleChatUI(true); // Pindahkan UI ke mode chat

                updateSendButtonState(); // Perbarui status tombol kirim

            })

            .catch(error => {

                console.error('Error converting image:', error);

                removeImage();

            });

    }



    // [BARU] Fungsi untuk menghapus gambar yang di-upload

    function removeImage() {

        currentImageData = null;

        elements.imagePreview.src = '';

        elements.imagePreviewContainer.style.display = 'none';

        elements.imageInput.value = ''; // Pastikan input file dikosongkan

        updateSendButtonState(); // Perbarui status tombol kirim

    }

    

    function initializeApp() {

        // [PERBAIKAN FINAL] Cek bahasa yang tersimpan, jika tidak valid, gunakan default 'id'

        const savedLang = localStorage.getItem('miraiLanguage');

        if (savedLang && uiStrings.hasOwnProperty(savedLang)) {

            currentLanguage = savedLang;

        } else {

            currentLanguage = 'en'; // Fallback ke bahasa default jika tidak valid

        }



        currentPersona = localStorage.getItem('miraiPersona') || 'default';

        const savedTheme = localStorage.getItem('miraiTheme') || 'dark';

        const savedApiKey = localStorage.getItem('miraiApiKey');

        elements.langDropdown.value = currentLanguage;

        elements.personaSelect.value = currentPersona;

        if (savedApiKey) {

            currentApiKey = savedApiKey;

            elements.apiKeyInput.value = savedApiKey;

        }

        initializeSlashCommands(currentLanguage);

        setTheme(savedTheme);

        updateUI();

        const historyLoaded = loadChatHistory();

        if (!historyLoaded) {

            initializeNewChatSession();

        }
// Tambahkan teks (Beta) di samping versi kalau mode betamodel aktif
if (isBeta) {
    const versionText = document.getElementById('settingsVersionText');
    if (versionText) {
        versionText.innerText += '#3FlashPreviewMode';
        versionText.style.color = '#00ff00'; // Kasih warna hijau biar kelihatan canggih
    }
}

    }



    function initializeNewChatSession() {

        const personaPromptText = uiStrings[currentLanguage][`persona${currentPersona.charAt(0).toUpperCase() + currentPersona.slice(1)}Prompt`];

        chatHistory = [{ role: "user", parts: [{ text: personaPromptText }] }];

        console.log('Sesi chat baru dimulai.');

    }



    function loadChatHistory() {

        const savedHistory = localStorage.getItem('miraiChatHistory');

        if (savedHistory) {

            chatHistory = JSON.parse(savedHistory);

            console.log('Riwayat percakapan berhasil dimuat.', chatHistory);

            return true; 

        }

        console.log('Tidak ada riwayat untuk dimuat.');

        return false; 

    }



    function saveChatHistory() {

        const maxHistoryLength = 50; 

        if (chatHistory.length > maxHistoryLength) {

            const personaPrompt = chatHistory[0];

            const conversation = chatHistory.slice(chatHistory.length - maxHistoryLength + 1);

            chatHistory = [personaPrompt, ...conversation];

        }

        localStorage.setItem('miraiChatHistory', JSON.stringify(chatHistory));

    }

    

    function clearChat() {

        elements.chatMessages.innerHTML = '';

        localStorage.removeItem('miraiChatHistory'); 

        initializeNewChatSession(); 

        toggleChatUI(false);

        updateDynamicPlaceholder();

        // [BARU] Hentikan TTS jika sedang berjalan

        if (window.speechSynthesis.speaking) {

            window.speechSynthesis.cancel();

        }

    }



    function showClearConfirmation() {

        const lang = uiStrings[currentLanguage];

        elements.customConfirmMessage.innerText = lang.confirmClearMessage;

        elements.confirmBtnYes.innerText = lang.confirmClearYes;

        elements.confirmBtnNo.innerText = lang.confirmClearNo;

        elements.customConfirmOverlay.classList.add('visible');

    }



    function hideClearConfirmation() {

        elements.customConfirmOverlay.classList.remove('visible');

    }

    

    function setPersona(persona, fromUserInteraction = false) {

        currentPersona = persona;

        elements.personaSelect.value = persona;

        localStorage.setItem('miraiPersona', persona);

        if (fromUserInteraction) {

            // clearChat(); // Diberi komentar agar tidak dijalankan sesuai permintaan

        }

    }



    function setLanguage(lang, fromUserInteraction = false) {

        currentLanguage = lang;

        elements.langDropdown.value = lang;

        localStorage.setItem('miraiLanguage', lang);

        initializeSlashCommands(currentLanguage);

        populateToolsMenu();

        updateUI();

        if (fromUserInteraction) {

            // clearChat(); // Diberi komentar agar tidak dijalankan sesuai permintaan

        }

    }



    async function askAI() {

        const userQuestion = elements.questionInput.value;



        // [MODIFIKASI] Jangan kirim jika tidak ada teks DAN tidak ada gambar

        if (userQuestion.trim() === '' && !currentImageData) return;



        const clientDateTime = getCurrentDateTimeString();

        const promptTemplate = uiStrings[currentLanguage].dateTimeContextPrompt;

        const contextPrompt = promptTemplate.replace('{dateTime}', clientDateTime);

        

        let promptToSendToAI;



        // [MODIFIKASI] Hanya proses slash command jika TIDAK ada gambar

        if (!currentImageData) {

            const processedPrompt = handleSlashCommand(userQuestion);

            if (processedPrompt !== null) {

                if (processedPrompt.startsWith('Error:')) {

                    return;

                }

                promptToSendToAI = `${contextPrompt}\n\n"${processedPrompt}"`;

            } else {

                promptToSendToAI = `${contextPrompt}\n\n"${userQuestion}"`;

            }

        } else {

            // Jika ada gambar, kirim teks apa adanya (jangan proses slash command)

            promptToSendToAI = `${contextPrompt}\n\n"${userQuestion}"`;

        }



        toggleChatUI(true);

        elements.questionInput.value = '';

        elements.questionInput.style.height = 'auto';

        elements.suggestionBox.classList.remove('visible');

        updateSendButtonState();

        elements.sendBtn.style.display = 'none';

        elements.clearBtnContainer.style.display = 'none';

        elements.stopBtn.style.display = 'block';



        // [MODIFIKASI] Tampilkan bubble user dengan teks dan gambar (jika ada)

        const userBubble = document.createElement('div');

        userBubble.classList.add('chat-bubble', 'user-bubble');

        

        let userBubbleHTML = '';

        if (currentImageData) {

            // Tampilkan preview gambar di bubble user

            userBubbleHTML += `<img src="${elements.imagePreview.src}" style="width: 100%; max-width: 200px; border-radius: 10px; margin-bottom: 5px;"><br>`;

        }

        // Gunakan .innerText untuk teks agar aman dari XSS

        const textNode = document.createTextNode(userQuestion);

        userBubble.appendChild(textNode);

        if(currentImageData) {

             // Jika ada gambar, tambahkan gambar di atas teks

             userBubble.innerHTML = userBubbleHTML; // Set HTML gambar

             userBubble.appendChild(document.createElement('br'));

             userBubble.appendChild(textNode); // Tambahkan teks setelah gambar

        }



        elements.chatMessages.appendChild(userBubble);

        setTimeout(() => userBubble.classList.add('fade-in'), 10);

        elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;



        // [MODIFIKASI TOTAL] Konstruksi 'parts' untuk multimodal

        const userParts = [];

        

        // 1. Tambahkan bagian teks

        userParts.push({ text: promptToSendToAI });



        // 2. Tambahkan bagian gambar jika ada

        if (currentImageData) {

            userParts.push({

                inlineData: {

                    mimeType: currentImageData.mimeType,

                    data: currentImageData.data

                }

            });

        }

        

        // Push ke chatHistory sebagai satu giliran 'user'

        chatHistory.push({ role: "user", parts: userParts }); 

        saveChatHistory(); 

        

        // Simpan status apakah gambar dikirim, lalu bersihkan UI

        const imageWasSent = !!currentImageData;

        removeImage(); // Kosongkan preview untuk pesan berikutnya



        const loadingBubble = showLoading();



        // [MODIFIKASI] Jangan cari jawaban lokal jika ada gambar

        if (!imageWasSent) {

            const localAnswer = findSmartAnswer(userQuestion);

            if (localAnswer) {

                // (Logika jawaban lokal Anda tetap sama)

                loadingBubble.remove();

                const aiBubble = createAiBubble(localAnswer, true);

                elements.chatMessages.appendChild(aiBubble);

                elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;

                elements.sendBtn.style.display = 'block';

                elements.stopBtn.style.display = 'none';

                elements.clearBtnContainer.style.display = 'block';

                return; 

            }

        }



        try {

            abortController = new AbortController();

            const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${currentApiKey}`;

            

            // [MODIFIKASI] Request body sekarang sudah benar

            const requestBody = { contents: chatHistory }; 



            const response = await fetch(url, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(requestBody), signal: abortController.signal });

            if (!response.ok) { throw new Error(`HTTP error! status: ${response.status}`); }

            const data = await response.json();

            let answer = uiStrings[currentLanguage].errorFallback;

            if (data.candidates?.[0]?.content?.parts?.[0]) {

                answer = data.candidates[0].content.parts[0].text;

                chatHistory.push({ role: "model", parts: [{ text: answer }] });

                saveChatHistory(); 

            }

            loadingBubble.remove();

            const aiBubble = createAiBubble(answer, false);

            elements.chatMessages.appendChild(aiBubble);

            await typeWriterEffect(aiBubble, answer);

            

            const copyBtn = document.createElement('i');

            copyBtn.classList.add('fas', 'fa-copy', 'copy-btn');

            copyBtn.setAttribute('onclick', 'copyToClipboard(this)');

            aiBubble.appendChild(copyBtn);



            const speakBtn = document.createElement('i');

            speakBtn.classList.add('fas', 'fa-volume-up', 'speak-btn');

            speakBtn.setAttribute('onclick', 'speakText(this)');

            aiBubble.appendChild(speakBtn);



            elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;

        } catch (error) {

            console.error('Error:', error);

            if (error.name !== 'AbortError') {

                const errorMessage = navigator.onLine ? uiStrings[currentLanguage].errorAPI : uiStrings[currentLanguage].errorConnection;

                loadingBubble.remove();

                const errorBubble = createAiBubble(errorMessage);

                elements.chatMessages.appendChild(errorBubble);

                elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;

            }

        } finally {

            elements.sendBtn.style.display = 'block';

            elements.stopBtn.style.display = 'none';

            elements.clearBtnContainer.style.display = 'block';

        }

    }

    

    function getCurrentDateTimeString() { const now = new Date(); const year = now.getFullYear(); const month = String(now.getMonth() + 1).padStart(2, '0'); const day = String(now.getDate()).padStart(2, '0'); const hours = String(now.getHours()).padStart(2, '0'); const minutes = String(now.getMinutes()).padStart(2, '0'); const seconds = String(now.getSeconds()).padStart(2, '0'); return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`; }

    function populateToolsMenu() { if (!elements.toolsMenu) return; elements.toolsMenu.innerHTML = ''; slashCommands.forEach(cmd => { const menuItem = document.createElement('div'); menuItem.classList.add('suggestion-item-slash'); menuItem.innerHTML = `<strong>${cmd.command}</strong><span>${cmd.description}</span>`; menuItem.addEventListener('click', () => { elements.questionInput.value = cmd.command + ' '; elements.toolsMenu.classList.remove('visible'); elements.toolsBtn.classList.remove('active'); elements.questionInput.focus(); }); elements.toolsMenu.appendChild(menuItem); }); }

    function updateSendButtonState() { 

        // [MODIFIKASI] Aktif jika ada teks ATAU gambar

        if (elements.questionInput.value.trim() === '' && !currentImageData) { 

            elements.sendBtn.classList.add('disabled'); 

            elements.sendBtn.disabled = true; 

        } else { 

            elements.sendBtn.classList.remove('disabled'); 

            elements.sendBtn.disabled = false; 

        } 

    }

    function saveApiKey() { const newKey = elements.apiKeyInput.value.trim(); if (newKey) { localStorage.setItem('miraiApiKey', newKey); currentApiKey = newKey; showCopyFeedback(uiStrings[currentLanguage].apiKeySaved); } else { localStorage.removeItem('miraiApiKey'); currentApiKey = DEFAULT_API_KEY; showCopyFeedback(uiStrings[currentLanguage].apiKeyRemoved); } }

    function toggleApiVisibility() { const input = elements.apiKeyInput; const icon = elements.toggleApiKey; if (input.type === 'password') { input.type = 'text'; icon.classList.remove('fa-eye'); icon.classList.add('fa-eye-slash'); } else { input.type = 'password'; icon.classList.remove('fa-eye-slash'); icon.classList.add('fa-eye'); } }

    function updateConnectionStatus() { if (navigator.onLine) { elements.statusDot.classList.remove('offline'); elements.statusDot.classList.add('online'); elements.statusLabel.innerText = uiStrings[currentLanguage].onlineStatus; } else { elements.statusDot.classList.remove('online'); elements.statusDot.classList.add('offline'); elements.statusLabel.innerText = uiStrings[currentLanguage].offlineStatus; } }

    function updateUI() { const lang = uiStrings[currentLanguage]; elements.infoText.innerText = lang.infoText; updateSettingsUI(); updateDynamicPlaceholder(); updateConnectionStatus(); }

    function updateDynamicPlaceholder() { const placeholders = uiStrings[currentLanguage].placeholderMessages; const randomIndex = Math.floor(Math.random() * placeholders.length); elements.questionInput.placeholder = placeholders[randomIndex]; }

    function updateSettingsUI() { const lang = uiStrings[currentLanguage]; if (!lang) return; elements.settingsHeaderTitle.innerText = lang.settingsHeaderTitle; elements.settingsAppearanceTitle.innerText = lang.settingsAppearanceTitle; elements.settingsThemeText.innerText = lang.settingsThemeText; elements.themeLightOption.innerText = lang.themeLightOption; elements.themeDarkOption.innerText = lang.themeDarkOption; elements.settingsAITitle.innerText = lang.settingsAITitle; elements.settingsPersonaText.innerText = lang.settingsPersonaText; elements.personaFormalOption.innerText = lang.personaFormalOption; elements.personaDefaultOption.innerText = lang.personaDefaultOption; elements.personaCreativeOption.innerText = lang.personaCreativeOption; elements.settingsAboutTitle.innerText = lang.settingsAboutTitle; elements.settingsVersionText.innerText = lang.settingsVersionText; elements.settingsAuthorText.innerText = lang.settingsAuthorText; elements.githubLink.innerText = lang.githubLink; elements.licenseLink.innerText = lang.licenseLink; elements.helpLink.innerText = lang.helpLink; elements.termsText.innerHTML = lang.termsText; elements.settingsApiTitle.innerText = lang.settingsApiTitle; elements.settingsApiText.innerText = lang.settingsApiText; document.title = lang.pageTitle; elements.saveApiBtn.innerText = lang.saveApiKeyBtn; elements.apiKeyInput.placeholder = lang.apiKeyPlaceholder; }

    function setTheme(theme) { elements.body.classList.remove('light-theme', 'dark-theme'); if (theme === 'light') { elements.body.classList.add('light-theme'); } else { elements.body.classList.add('dark-theme'); } localStorage.setItem('miraiTheme', theme); elements.themeSelect.value = theme; }

// Di function showSettingsPage(), tambahkan:
function showSettingsPage() {
    elements.settingsPage.classList.add('active');
    
    // Force calculate height
    setTimeout(() => {
        const scrollContainer = document.querySelector('.settings-scroll-container');
        const content = document.querySelector('.settings-content');
        
        if (scrollContainer && content) {
            // Set height manual
            const windowHeight = window.innerHeight;
            const headerHeight = 80; // approximate
            scrollContainer.style.height = (windowHeight - headerHeight) + 'px';
            
            // Force scrollable
            scrollContainer.style.overflowY = 'auto';
            scrollContainer.style.webkitOverflowScrolling = 'touch';
            
            console.log("Settings Height Set:", scrollContainer.style.height);
        }
    }, 50);
}

function hideSettingsPage() {
    elements.settingsPage.classList.remove('active');
    document.body.classList.remove('settings-open');
    document.body.style.overflow = ''; // Unlock body scroll
}

    function toggleChatUI(active) { if (active) { elements.body.classList.add('chat-active'); elements.inputContainer.classList.remove('centered'); elements.inputContainer.classList.add('bottom'); elements.logoContainer.classList.add('logo-hidden'); elements.languageSwitcher.classList.add('lang-hidden'); elements.infoText.style.display = 'block'; } else { elements.body.classList.remove('chat-active'); elements.inputContainer.classList.remove('bottom'); elements.inputContainer.classList.add('centered'); elements.logoContainer.classList.remove('logo-hidden'); elements.languageSwitcher.classList.remove('lang-hidden'); elements.infoText.style.display = 'none'; } }

function simulateLoading(duration) {
    const splashBar = document.querySelector('.loading-bar');
    
    // Jika durasi 0 (Mode PWA), langsung eksekusi penghapusan
    if (duration === 0) {
        if (elements.splashScreen) {
            elements.splashScreen.style.display = 'none';
            elements.splashScreen.classList.add('hidden');
        }
        return; // Berhenti di sini, jangan lanjut ke bawah
    }

    // --- Logic untuk User Biasa (Duration > 0) ---
    if (!splashBar || !elements.splashScreen) return;

    const startTime = Date.now();
    const intervalId = setInterval(() => {
        const elapsedTime = Date.now() - startTime;
        let progress = (elapsedTime / duration) * 100;

        if (progress >= 100) {
            progress = 100;
            clearInterval(intervalId);
            setTimeout(() => {
                elements.splashScreen.classList.add('hidden');
                // Kasih delay dikit biar halus hilangnya
                setTimeout(() => { elements.splashScreen.style.display = 'none'; }, 500);
            }, 500);
        }
        splashBar.style.width = `${progress}%`;
    }, 50);
}

    function showSuggestions() { const query = elements.questionInput.value.toLowerCase().trim(); elements.suggestionBox.innerHTML = ''; elements.suggestionBox.classList.remove('visible'); if (query.startsWith('/')) { const commandQuery = query.substring(1); const matchingCommands = slashCommands.filter(cmd => cmd.command.substring(1).startsWith(commandQuery) ); if (matchingCommands.length > 0) { elements.suggestionBox.classList.add('visible'); matchingCommands.forEach(cmd => { const div = document.createElement('div'); div.classList.add('suggestion-item-slash'); div.innerHTML = `<strong>${cmd.command}</strong><span>${cmd.description}</span>`; div.addEventListener('click', () => { elements.questionInput.value = cmd.command + ' '; elements.suggestionBox.classList.remove('visible'); elements.questionInput.focus(); }); elements.suggestionBox.appendChild(div); }); } } else { if (query.length < 2) return; const suggestions = Object.keys(faqDatabase) .filter(key => key.toLowerCase().includes(query)) .slice(0, 5); if (suggestions.length > 0) { elements.suggestionBox.classList.add('visible'); suggestions.forEach(suggestion => { const div = document.createElement('div'); div.classList.add('suggestion-item'); div.innerText = suggestion; div.addEventListener('click', () => { elements.questionInput.value = suggestion; elements.suggestionBox.classList.remove('visible'); askAI(); }); elements.suggestionBox.appendChild(div); }); } } }

    function findSmartAnswer(question) { const normalized = question.toLowerCase().trim(); const sortedKeys = Object.keys(faqDatabase).sort((a, b) => b.length - a.length); for (const key of sortedKeys) { const normalizedKey = key.toLowerCase().replace("?", ""); if (normalized.includes(normalizedKey)) return faqDatabase[key]; } return null; }

    function typeWriterEffect(element, text, speed = 0.5) { const parsedHtml = marked.parse(text); let i = 0; element.innerHTML = ''; const tempElement = document.createElement('div'); tempElement.innerHTML = parsedHtml; const textToType = tempElement.innerText; return new Promise(resolve => { function type() { if (i < textToType.length) { element.innerHTML += textToType.charAt(i); i++; setTimeout(type, speed); } else { element.innerHTML = parsedHtml; resolve(); } } type(); }); }

    function showLoading() { const loadingBubble = document.createElement('div'); loadingBubble.classList.add('chat-bubble', 'ai-bubble', 'typing-indicator', 'fade-in'); loadingBubble.innerHTML = '<span></span><span></span><span></span>'; elements.chatMessages.appendChild(loadingBubble); return loadingBubble; }

    

    function stopAI() {

        if (abortController) {

            abortController.abort();

            console.log("Response aborted.");

            elements.stopBtn.style.display = 'none';

            elements.sendBtn.style.display = 'block';

            elements.clearBtnContainer.style.display = 'block';

            const loadingBubble = document.querySelector('.typing-indicator');

            if (loadingBubble) loadingBubble.remove();

        }

        // [MODIFIKASI] Hentikan juga TTS yang sedang berjalan

        if (window.speechSynthesis.speaking) {

            window.speechSynthesis.cancel();

            // Reset semua ikon tombol speak

            document.querySelectorAll('.speak-btn').forEach(btn => {

                btn.classList.remove('fa-stop');

                btn.classList.add('fa-volume-up');

            });

        }

    }



    function handleSlashCommand(question) { if (!question.startsWith('/')) { return null; } const parts = question.split(' '); const command = parts[0].toLowerCase(); switch (command) { case '/translate': { const toIndex = parts.indexOf('to'); if (toIndex === -1 || toIndex < 2) { return "Error: Invalid format. Use /translate [text] to [language]"; } const textToTranslate = parts.slice(1, toIndex).join(' '); const targetLanguage = parts.slice(toIndex + 1).join(' '); return `Translate the following text to ${targetLanguage}: "${textToTranslate}"`; } case '/summarize': { const textToSummarize = parts.slice(1).join(' '); if (textToSummarize.length < 20) { return "Error: Please provide more text to summarize."; } return `Provide a concise summary of the following text: "${textToSummarize}"`; } case '/rephrase': { const asIndex = parts.indexOf('as'); if (asIndex === -1 || asIndex < 2) { return "Error: Invalid format. Use /rephrase [text] as [tone]"; } const textToRephrase = parts.slice(1, asIndex).join(' '); const tone = parts.slice(asIndex + 1).join(' '); return `Rephrase the following text in a ${tone} tone: "${textToRephrase}"`; } case '/ideate': { const forIndex = parts.indexOf('for'); if (forIndex === -1 || forIndex < 3 || isNaN(parseInt(parts[1]))) { return "Error: Invalid format. Use /ideate [number] ideas for [topic]"; } const number = parts[1]; const topic = parts.slice(forIndex + 1).join(' '); return `Generate ${number} ideas for ${topic}. Present them as a numbered list.`; } case '/fix': { const textToFix = parts.slice(1).join(' '); if (!textToFix) { return "Error: Please provide text to fix. Use /fix [text]"; } return `Proofread and correct any grammatical errors and spelling mistakes in the following text. Only provide the corrected text: "${textToFix}"`; } case '/explain': { const likeIndex = parts.findIndex(part => part.toLowerCase() === "like"); if (likeIndex === -1 || likeIndex < 2) { return "Error: Invalid format. Use /explain [concept] like I'm [audience]"; } const concept = parts.slice(1, likeIndex).join(' '); const audienceIndex = parts.indexOf("I'm") > -1 ? parts.indexOf("I'm") : parts.indexOf("i'm"); if (audienceIndex === -1 || audienceIndex <= likeIndex) { return "Error: Invalid audience format. Use \"like I'm ...\""; } const audience = parts.slice(audienceIndex + 1).join(' '); return `Explain the concept of "${concept}" as if you were talking to a ${audience}.`; } case '/code': { const toIndex = parts.indexOf('to'); if (toIndex === -1 || toIndex < 3) { return "Error: Invalid format. Use /code a [language] function to [description]"; } const language = parts[2]; const description = parts.slice(toIndex + 1).join(' '); return `Write a code snippet in ${language} for the following task: "${description}". Provide only the code, enclosed in a markdown code block.`; } case '/search': { const query = parts.slice(1).join(' '); if (!query) { return "Error: Please provide a search query. Use /search [query]"; } return `Search the web for information about "${query}". Provide a concise summary and, if possible, include relevant links.`; } default: return `Error: Unknown command "${command}". Try /translate or /summarize.`; } }

    

    function createAiBubble(text, useInnerHTML = true) {

        const bubble = document.createElement('div');

        bubble.classList.add('chat-bubble', 'ai-bubble', 'fade-in');

        bubble.setAttribute('data-raw-text', text);

        if (useInnerHTML) {

            // [MODIFIKASI] Tambahkan tombol copy DAN speak

            bubble.innerHTML = `${marked.parse(text)}

                              <i class="fas fa-copy copy-btn" onclick="copyToClipboard(this)"></i>

                              <i class="fas fa-volume-up speak-btn" onclick="speakText(this)"></i>`;

        }

        return bubble;

    }



    // --- [BARU] FUNGSI UNTUK TTS ---

    

    /**

     * Mendapatkan kode bahasa BCP 47 untuk SpeechSynthesis

     * @param {string} lang - Kode bahasa dari aplikasi (e.g., 'id', 'en', 'jp')

     * @returns {string} Kode bahasa BCP 47 (e.g., 'id-ID', 'en-US', 'ja-JP')

     */

    function getLangCodeForSpeech(lang) {

        if (lang === 'en-uk') return 'en-GB';

        if (lang === 'en') return 'en-US';

        if (lang === 'jp') return 'ja-JP';

        if (lang === 'id') return 'id-ID';

        return 'id-ID'; // Fallback default

    }



    /**

     * Membacakan teks dari bubble AI menggunakan Web Speech API

     * @param {HTMLElement} element - Elemen ikon speaker yang diklik

     */

    function speakText(element) {

        const aiBubble = element.closest('.ai-bubble');

        const textToSpeak = aiBubble.getAttribute('data-raw-text');

        const icon = element;



        // Jika tombol stop (ikon stop) diklik, hentikan audio

        if (icon.classList.contains('fa-stop')) {

            window.speechSynthesis.cancel();

            // Event 'onend' akan otomatis mengubah ikon kembali

            return;

        }



        // Jika ada audio lain yang sedang diputar, hentikan dulu

        if (window.speechSynthesis.speaking) {

            window.speechSynthesis.cancel();

            // Reset semua ikon lain (jika ada) sebelum memulai yang baru

             document.querySelectorAll('.speak-btn').forEach(btn => {

                btn.classList.remove('fa-stop');

                btn.classList.add('fa-volume-up');

            });

        }



        if (!textToSpeak) return;



        const utterance = new SpeechSynthesisUtterance(textToSpeak);

        utterance.lang = getLangCodeForSpeech(currentLanguage);



        // Saat audio mulai diputar

        utterance.onstart = () => {

            icon.classList.remove('fa-volume-up');

            icon.classList.add('fa-stop');

        };



        // Saat audio selesai (baik selesai normal atau dibatalkan)

        utterance.onend = () => {

            icon.classList.remove('fa-stop');

            icon.classList.add('fa-volume-up');

        };



        // Jika terjadi error

        utterance.onerror = (event) => {

            console.error('SpeechSynthesis Error:', event.error);

            icon.classList.remove('fa-stop');

            icon.classList.add('fa-volume-up');

        };



        window.speechSynthesis.speak(utterance);

    }

    // --- [AKHIR FUNGSI BARU] ---





    function copyToClipboard(element) { const aiBubble = element.closest('.ai-bubble'); const textToCopy = aiBubble.getAttribute('data-raw-text'); const formattedText = `${textToCopy}${uiStrings[currentLanguage].copySuffix}`; const tempInput = document.createElement('textarea'); tempInput.value = formattedText; document.body.appendChild(tempInput); tempInput.select(); tempInput.setSelectionRange(0, 99999); document.execCommand('copy'); document.body.removeChild(tempInput); showCopyFeedback(uiStrings[currentLanguage].copyFeedback); }

    function showCopyFeedback(message) { const feedbackDiv = document.createElement('div'); feedbackDiv.innerText = message; feedbackDiv.style.cssText = ` position: fixed; bottom: 150px; left: 50%; transform: translateX(-50%); background-color: #444; color: #fff; padding: 10px 20px; border-radius: 20px; font-size: 14px; z-index: 200; opacity: 0; transition: opacity 0.5s ease-in-out; `; document.body.appendChild(feedbackDiv); setTimeout(() => { feedbackDiv.style.opacity = 1; }, 10); setTimeout(() => { feedbackDiv.style.opacity = 0; setTimeout(() => feedbackDiv.remove(), 500); }, 2000); }

    function checkIndicatorPosition() { const connectionStatus = document.getElementById('connectionStatus'); if (!connectionStatus) return; const indicatorRect = connectionStatus.getBoundingClientRect(); const userBubbles = document.querySelectorAll('.user-bubble'); let isOverlapping = false; for (const bubble of userBubbles) { const bubbleRect = bubble.getBoundingClientRect(); const verticalOverlap = indicatorRect.bottom > bubbleRect.top && indicatorRect.top < bubbleRect.bottom; const horizontalOverlap = indicatorRect.right > bubbleRect.left && indicatorRect.right < bubbleRect.right; if (verticalOverlap && horizontalOverlap) { isOverlapping = true; break; } } connectionStatus.classList.toggle('hidden-by-scroll', isOverlapping); }



    // --- Titik Eksekusi Utama ---



    document.addEventListener('DOMContentLoaded', () => {

        // [FIX] Isi variabel `elements` sekarang, setelah HTML dijamin siap

        elements = { 

            questionInput: document.getElementById('questionInput'), sendBtn: document.getElementById('sendBtn'), stopBtn: document.getElementById('stopBtn'), clearBtn: document.getElementById('clearBtn'), clearBtnContainer: document.getElementById('clearBtnContainer'), settingsBtn: document.getElementById('settingsBtn'), chatMessages: document.getElementById('chatMessages'), suggestionBox: document.getElementById('suggestionBox'), body: document.body, inputContainer: document.getElementById('inputContainer'), logoContainer: document.querySelector('.logo-container'), splashScreen: document.getElementById('splash-screen'), langDropdown: document.getElementById('langDropdown'), languageSwitcher: document.getElementById('languageSwitcher'), infoText: document.getElementById('infoText'), settingsPage: document.getElementById('settingsPage'), backBtn: document.getElementById('backBtn'), themeSelect: document.getElementById('themeSelect'), personaSelect: document.getElementById('personaSelect'), settingsHeaderTitle: document.getElementById('settingsHeaderTitle'), settingsAppearanceTitle: document.getElementById('settingsAppearanceTitle'), settingsThemeText: document.getElementById('settingsThemeText'), themeLightOption: document.getElementById('themeLightOption'), themeDarkOption: document.getElementById('themeDarkOption'), settingsAITitle: document.getElementById('settingsAITitle'), settingsPersonaText: document.getElementById('settingsPersonaText'), personaFormalOption: document.getElementById('personaFormalOption'), personaDefaultOption: document.getElementById('personaDefaultOption'), personaCreativeOption: document.getElementById('personaCreativeOption'), settingsAboutTitle: document.getElementById('settingsAboutTitle'), settingsVersionText: document.getElementById('settingsVersionText'), settingsAuthorText: document.getElementById('settingsAuthorText'), githubLink: document.getElementById('githubLink'), licenseLink: document.getElementById('licenseLink'), statusDot: document.getElementById('statusDot'), statusLabel: document.getElementById('statusLabel'), apiKeyInput: document.getElementById('apiKeyInput'), toggleApiKey: document.getElementById('toggleApiKey'), saveApiBtn: document.getElementById('saveApiBtn'), settingsApiTitle: document.getElementById('settingsApiTitle'), settingsApiText: document.getElementById('settingsApiText'), toolsBtn: document.getElementById('toolsBtn'), toolsMenu: document.getElementById('toolsMenu'), customConfirmOverlay: document.getElementById('customConfirmOverlay'), customConfirmMessage: document.getElementById('customConfirmMessage'), confirmBtnYes: document.getElementById('confirmBtnYes'), confirmBtnNo: document.getElementById('confirmBtnNo'), helpLink: document.getElementById('helpLink'), termsText: document.getElementById('termsText'),

uploadImageBtn: document.getElementById('uploadImageBtn'),

            imageInput: document.getElementById('imageInput'),

            imagePreviewContainer: document.getElementById('imagePreviewContainer'),

            imagePreview: document.getElementById('imagePreview'),

            removeImageBtn: document.getElementById('removeImageBtn')

        };



        // Pasang semua event listener setelah `elements` diisi

        elements.sendBtn.addEventListener('click', askAI);

        elements.stopBtn.addEventListener('click', stopAI);

        elements.clearBtn.addEventListener('click', showClearConfirmation);

        elements.settingsBtn.addEventListener('click', showSettingsPage);

        elements.backBtn.addEventListener('click', hideSettingsPage);

        elements.themeSelect.addEventListener('change', (e) => setTheme(e.target.value));

        elements.personaSelect.addEventListener('change', (e) => setPersona(e.target.value, true));

        elements.langDropdown.addEventListener('change', (event) => setLanguage(event.target.value, true));

        elements.questionInput.addEventListener('keydown', (event) => { if (event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); if (!elements.sendBtn.disabled) { askAI(); } } });

        elements.questionInput.addEventListener('input', () => { showSuggestions(); updateSendButtonState(); elements.questionInput.style.height = 'auto'; elements.questionInput.style.height = elements.questionInput.scrollHeight + 'px'; });

        elements.saveApiBtn.addEventListener('click', saveApiKey);

elements.uploadImageBtn.addEventListener('click', () => elements.imageInput.click());

        elements.imageInput.addEventListener('change', handleImageUpload);

        elements.removeImageBtn.addEventListener('click', removeImage);

        elements.toggleApiKey.addEventListener('click', toggleApiVisibility);

        elements.confirmBtnYes.addEventListener('click', () => { 
    clearChat(); 
    hideClearConfirmation(); // <--- BARIS INI DITAMBAHKAN
});

        elements.confirmBtnNo.addEventListener('click', hideClearConfirmation);

        elements.toolsBtn.addEventListener('click', (event) => { event.stopPropagation(); const isActive = elements.toolsBtn.classList.contains('active'); elements.suggestionBox.classList.remove('visible'); if (!isActive) { elements.toolsMenu.classList.add('visible'); elements.toolsBtn.classList.add('active'); } else { elements.toolsMenu.classList.remove('visible'); elements.toolsBtn.classList.remove('active'); } });

        document.addEventListener('click', (event) => { if (elements.toolsMenu && !elements.toolsMenu.contains(event.target) && !elements.toolsBtn.contains(event.target)) { elements.toolsMenu.classList.remove('visible'); elements.toolsBtn.classList.remove('active'); } });

        window.addEventListener('scroll', checkIndicatorPosition, { passive: true });

// --- LOGIKA EXPORT/IMPORT JSON [BARU] ---

// Ganti fungsi export kamu dengan versi yang lebih 'kuat' ini:
document.getElementById('exportBtn').addEventListener('click', () => {
    // Ambil SEMUA yang ada di localStorage ke dalam satu objek
    const allData = {};
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        allData[key] = localStorage.getItem(key);
    }
    
    const backupData = JSON.stringify(allData); // Pakai allData, bukan localStorage langsung
    const blob = new Blob([backupData], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = `mirai_full_backup_${new Date().toISOString().slice(0,10)}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    showCopyFeedback(uiStrings[currentLanguage].exportSuccessText);

});

// Trigger input file pas tombol Import diklik
document.getElementById('importBtn').addEventListener('click', () => {
    document.getElementById('importFileInput').click();
});

// Fungsi Import (Baca file JSON dan masukkan ke localStorage)
document.getElementById('importFileInput').addEventListener('change', (event) => {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = JSON.parse(e.target.result);
            // Bersihkan storage lama (opsional) atau langsung timpa
            Object.keys(data).forEach(key => {
                localStorage.setItem(key, data[key]);
            });
            alert(uiStrings[currentLanguage].importSuccessText);
            location.reload();
        } catch (err) {
            alert(uiStrings[currentLanguage].importErrorText);
            console.error(err);
        }
    };
    reader.readAsText(file);
});

// Jalankan inisialisasi aplikasi
initializeApp();

if (!isPWA) {
    // Kalo BUKAN PWA, baru kita paksa munculin pake JS
    if (elements.splashScreen) {
        elements.splashScreen.style.display = 'flex';
        simulateLoading(3000);
    }
} else {
    // Kalo PWA, biarin aja display:none, langsung gas inisialisasi
    console.log("PWA Mode: Skip total!");
    initializeApp(); 
}

        updateConnectionStatus();

        populateToolsMenu();

        updateSendButtonState();



        // [BARU] Pastikan TTS berhenti jika pengguna menutup tab/jendela

        window.addEventListener('beforeunload', () => {

            if (window.speechSynthesis.speaking) {

                window.speechSynthesis.cancel();

            }

        });

    });



    window.addEventListener('online', updateConnectionStatus);

    window.addEventListener('offline', updateConnectionStatus);

</script>

</body>

</html>
