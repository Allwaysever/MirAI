<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MirAI | Support Our Development</title>
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/Allwaysever/MirAI/refs/heads/main/Assets/Favicon.png">
    <meta name="description" content="Support MirAI's development by contributing to server costs and keeping the project free for everyone.">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Arial:wght@400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        :root {
            --color-accent: #ffce00; 
            --color-primary: #ffffff; 
            --color-dark-bg: #0f0f0f; 
            --color-card-bg: rgba(33, 33, 33, 0.7); 
            --color-border: #4B4F50; 
        }
        body {
            font-family: Arial, sans-serif;
            background-color: var(--color-dark-bg); 
            color: var(--color-primary);
            min-height: 100vh;
            display: flex; 
            justify-content: center;
            align-items: center;
        }
        .card-srui {
            border-radius: 25px; 
            background-color: var(--color-card-bg);
            border: 1px solid var(--color-border);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.2);
        }
        .accent-button {
            background-color: var(--color-accent);
            color: var(--color-dark-bg);
            font-weight: 700;
            border-radius: 9999px;
            transition: all 0.2s ease-in-out;
            border: 2px solid var(--color-accent); 
        }
        .accent-button:hover {
            background-color: #e6b800; 
            transform: translateY(-1px);
        }
        .page-content {
            display: none;
        }
        .page-content.active {
            display: block;
        }
    </style>
</head>
<body class="p-4">

    <main class="w-full max-w-lg mx-auto py-10">

        <header class="text-center mb-8">
            <div class="flex items-center justify-center space-x-3">
                <img src="https://raw.githubusercontent.com/Allwaysever/MirAI/refs/heads/main/Assets/Logo%20Icon.png" onerror="this.onerror=null; this.src='https://placehold.co/40x40/ffce00/0f0f0f?text=MirAI';" class="w-10 h-10 rounded-lg object-contain" alt="MirAI Logo">
                <span><span style="font-weight: bold; font-size: 1.5em;">MirAI</span> <span style="font-weight: 100; font-size: 1.5em;">Support</span></span>
            </div>
        </header>

        <section id="donate" class="page-content active p-8 card-srui text-center">
            <h1 class="text-3xl font-extrabold mb-2 text-yellow-400">
                Support Our Development ‚òï
            </h1>
            <p class="text-lg text-gray-300 mb-6">
                Your contribution helps sustain MirAI and enables continuous development.
            </p>

            <div class="space-y-4 mb-10 text-left p-4 bg-gray-800 rounded-xl">
                <p class="text-white font-regular flex items-center space-x-3">
                    <span class="text-xl text-yellow-400"><i class="fas fa-check"></i></span>
                    <span><span style="color: #ffce00;">45%</span> is allocated for <b>real-time</b> Google Gemini API costs.</span>
                </p>
                <p class="text-white font-regular flex items-center space-x-3">
                    <span class="text-xl text-yellow-400"><i class="fas fa-check"></i></span>
                    <span>Supports <b>server maintenance</b> and <span style="color: #ffce00;">55%</span> for new feature development.</span>
                </p>
                <p class="text-white font-regular flex items-center space-x-3">
                    <span class="text-xl text-yellow-400"><i class="fas fa-check"></i></span>
                    <span>MirAI remains fully <b>open-source</b> and free!</span>
                </p>
            </div>
            
            <div class="text-center">
                 <button id="checkout-button" class="accent-button text-xl px-8 py-3 shadow-xl focus:outline-none focus:ring-4 focus:ring-yellow-400 focus:ring-opacity-50 min-w-[300px] inline-block">
                    Support Now
                </button>
            </div>

            <div class="mt-8 pt-6 border-t border-gray-700">
                <p class="text-sm text-gray-400 text-center">
                    You will be redirected to our secure donation portal.
                </p>
            </div>

        </section>

        <section id="thanks" class="page-content p-8 card-srui text-center">
            <div class="text-5xl mb-4">üéâ</div>
            <h1 class="text-3xl font-extrabold mb-4 text-yellow-400">
                Thank You for Your Support!
            </h1>

            <p class="text-lg text-gray-300 mb-4">
                Your contribution directly supports MirAI's capabilities.
            </p>

            <p class="text-md text-red-400 font-semibold mb-8 border border-red-400 p-3 rounded-lg bg-red-900 bg-opacity-30">
                ‚ö†Ô∏è <b>IMPORTANT:</b> Your donation helps a lot. Please click the button below to return to MirAI.
            </p>
            
            <p class="text-md font-medium text-gray-400 mb-10">
                Your support allows MirAI to continue answering questions and evolving! ‚ù§Ô∏è
            </p>
            
            <a href="https://allwaysevermirai.netlify.app/" onclick="localStorage.removeItem('mirai_last_donate_click');" class="accent-button text-lg px-6 py-3 shadow-md focus:outline-none focus:ring-4 focus:ring-yellow-400 focus:ring-opacity-50 inline-block">
                Return to MirAI ‚Üí
            </a>
            
            <p class="text-sm text-gray-500 mt-6">
                Sincerely, The Allwaysever Team.
            </p>
        </section>

        <section id="areyousure" class="page-content p-8 card-srui text-center">
            <div class="text-5xl mb-4">ü§î</div>
            <h1 class="text-3xl font-extrabold mb-4 text-yellow-400">
                Completing Your Donation?
            </h1>

            <p class="text-lg text-gray-300 mb-4">
                We noticed you recently started a donation. The payment page should have opened in a new tab.
            </p>

            <p class="text-md text-gray-400 mb-10">
                Please complete your donation to help us continue development!
            </p>
            
            <div id="countdown-are-you-sure" class="text-sm text-yellow-400 font-bold mb-4">
                This page will automatically proceed in <span id="areyousure-timer">90</span> seconds.
            </div>

            <div class="space-y-3">
                <a href="https://saweria.co/Allwaysever" target="_blank" class="accent-button text-lg px-6 py-3 shadow-md focus:outline-none focus:ring-4 focus:ring-yellow-400 focus:ring-opacity-50 inline-block w-full">
                    Return to Payment Page (New Tab)
                </a>
                </div>
            <p class="text-sm text-gray-500 mt-6">
                We appreciate your genuine support for our project's sustainability.
            </p>
        </section>

    </main>

    <script>
        const EXTERNAL_DONATE_BASE_URL = "https://trakteer.id/Allwaysever"; 
        const SUGGESTED_AMOUNT = 1000; 
        
        // Time Constants: Only AREYOUSURE_TIMEOUT_MS is used for the transition timer
        const AREYOUSURE_TIMEOUT_MS = 1.5 * 60 * 1000; // 1.5 minutes (90000 ms)

        const LAST_CLICK_KEY = 'mirai_last_donate_click';
        let timeoutTimer; // Timer for handling automatic transitions
        let intervalTimer; // Timer for countdown
        
        const checkoutButton = document.getElementById('checkout-button');

        function formatRupiah(number) {
            return new Intl.NumberFormat('id-ID', {
                style: 'decimal',
                minimumFractionDigits: 0
            }).format(number);
        }

        // Function to stop all running timers
        function stopAllTimers() {
            if (timeoutTimer) clearTimeout(timeoutTimer);
            if (intervalTimer) clearInterval(intervalTimer);
        }

        // handleConfirmation function removed as its button was removed.

        checkoutButton.addEventListener('click', (e) => {
            e.preventDefault();
            
            const formattedAmount = formatRupiah(SUGGESTED_AMOUNT);
            localStorage.setItem(LAST_CLICK_KEY, Date.now());

            const donationUrl = EXTERNAL_DONATE_BASE_URL; 
            window.open(donationUrl, '_blank');
            
            // MOVE TO #areyousure
            window.location.hash = 'areyousure'; 
            
            alert(`Payment tab has been opened. Please manually enter a minimum amount of Rp ${formattedAmount}. Thank you!`);
        });

        function handleHashChange() {
            stopAllTimers(); // Stop previous timers
            
            const currentHash = window.location.hash.substring(1);
            const lastClickTime = localStorage.getItem(LAST_CLICK_KEY);
            const now = Date.now();
            let targetHash = currentHash || 'donate';

            // Main logic for setting the correct hash
            if (lastClickTime) {
                const lastClick = parseInt(lastClickTime);
                
                if (isNaN(lastClick)) {
                    // Prevention if lastClickTime is invalid
                    localStorage.removeItem(LAST_CLICK_KEY);
                    targetHash = 'donate';
                } else {
                    const timeElapsed = now - lastClick;
                    
                    if (timeElapsed < AREYOUSURE_TIMEOUT_MS) {
                        // Still within the 1.5-minute donation window
                        if (targetHash !== 'thanks') {
                            targetHash = 'areyousure'; 
                        }
                    } else {
                        // Past the 1.5-minute donation window
                        
                        if (targetHash === 'areyousure') {
                            // AUTOMATICALLY MOVE TO #thanks after time expires
                            targetHash = 'thanks'; 
                        } else if (targetHash !== 'thanks') {
                            // If time has passed and not on #thanks, consider it finished
                            localStorage.removeItem(LAST_CLICK_KEY);
                            targetHash = 'donate';
                        }
                        // Note: If already on #thanks, remain on #thanks.
                    }
                }
            } else if (targetHash === 'thanks' || targetHash === 'areyousure') {
                // If there's no click record, return to donate
                 targetHash = 'donate';
            }


            document.querySelectorAll('.page-content').forEach(section => {
                section.classList.remove('active');
            });
            
            const activeSection = document.getElementById(targetHash);
            if (activeSection) {
                activeSection.classList.add('active');
            } else {
                document.getElementById('donate').classList.add('active');
            }


            // COUNTDOWN and TIMER Logic
            if (targetHash === 'areyousure') {
                const lastClick = parseInt(lastClickTime);
                const timeElapsed = now - lastClick;
                const timeRemaining = AREYOUSURE_TIMEOUT_MS - timeElapsed;
                
                // Set timer to move to #thanks after time expires
                timeoutTimer = setTimeout(() => {
                    window.location.hash = 'thanks';
                }, timeRemaining);

                // Set interval for countdown in the UI
                let secondsLeft = Math.ceil(timeRemaining / 1000);
                const timerElement = document.getElementById('areyousure-timer');
                if (timerElement) {
                    timerElement.textContent = secondsLeft;
                }

                intervalTimer = setInterval(() => {
                    secondsLeft--;
                    if (timerElement) {
                        timerElement.textContent = secondsLeft;
                    }
                    if (secondsLeft <= 0) {
                        clearInterval(intervalTimer);
                    }
                }, 1000);

            } else if (targetHash === 'thanks') {
                // #thanks page: Remove all timers and auto-redirect.
                localStorage.removeItem(LAST_CLICK_KEY); // Remove click record after reaching the thanks page
                
                // Hide countdown timer element (if it exists, even though it's removed in the HTML)
                const countdownElement = document.getElementById('countdown-thanks');
                if (countdownElement) {
                    countdownElement.style.display = 'none';
                }
            }
        }
        
        handleHashChange();
        window.addEventListener('hashchange', handleHashChange);
    </script>

</body>
</html>
