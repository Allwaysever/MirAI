<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Debug Page (MirAI Style - 4 Tests)</title>
    
    <link rel="stylesheet" href="https://egkoppel.github.io/product-sans/google-fonts.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        /* ================================================= */
        /* BASE STYLE (DIADAPTASI DARI MirAI.html) */
        /* ================================================= */
        body {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'Product Sans', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.4s ease-in-out, color 0.4s ease-in-out;
            padding: 20px;
            padding-top: 80px;
        }
        
        /* TEMA GELAP (DEFAULT) */
        body.dark-theme {
            background-color: #1B1C1E;
            color: #fff;
        }

        /* TEMA TERANG */
        body.light-theme {
            background-color: #e9e9e9;
            color: #444;
        }

        /* Container Utama Mirip Chat Container di MirAI */
        .main-container {
            width: 100%;
            max-width: 600px;
            padding: 20px;
            box-sizing: border-box;
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        /* Adaptasi Style untuk Elemen HTML Dasar */
        h1, h2 {
            font-weight: 600;
            border-bottom: 2px solid;
            padding-bottom: 5px;
        }

        /* Warna Border untuk Dark Mode */
        body.dark-theme h1, body.dark-theme h2,
        body.dark-theme .test-result {
            border-color: #ffce00; /* Warna aksen kuning MirAI */
        }
        
        /* Warna Border untuk Light Mode */
        body.light-theme h1, body.light-theme h2,
        body.light-theme .test-result {
            border-color: #444;
        }

        /* Style untuk Tombol Tema */
        #themeToggleBtn {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #ffce00;
            color: #0f0f0f;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: color 0.3s ease, transform 0.2s ease, background-color 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 100;
            font-size: 1.2em;
        }
        
        #themeToggleBtn:hover { 
            background-color: #eab308;
            transform: scale(1.1); 
        }

        /* Penyesuaian Tombol untuk Light Theme */
        body.light-theme #themeToggleBtn {
            background-color: #444;
            color: #e9e9e9;
        }

        body.light-theme #themeToggleBtn:hover {
            background-color: #222;
        }

        /* Style untuk Log Aktivitas dan Hasil Tes */
        .log-item {
            padding: 8px 0;
            margin: 5px 0;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.3);
            font-size: 0.9em;
            word-wrap: break-word;
        }

        body.light-theme .log-item {
             border-bottom: 1px dashed rgba(0, 0, 0, 0.3);
        }

        /* Tampilan Hasil Tes */
        .test-result {
            padding: 10px;
            margin-bottom: 15px;
            border: 2px solid;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .test-result strong {
            color: #ffce00; /* Aksen kuning MirAI */
        }
    </style>
</head>

<body class="dark-theme">
    
    <button id="themeToggleBtn">
        <i class="fas fa-sun"></i> 
    </button>

    <div class="main-container">
        <h1>Halaman Tes Development</h1>
        <p>Halaman ini akan menjalankan 4 jenis tes JavaScript untuk *debugging*.</p>
        <hr>
        
        <button id="runAllTestsBtn" style="margin-top: 15px;">
             <i class="fas fa-microchip"></i> Jalankan Semua Tes
        </button>

        <h2>Hasil Tes:</h2>

        <h3>1. Tes DOM & Responsivitas</h3>
        <div id="dom-test-result" class="test-result">
            <p id="test-element">Teks DOM akan berubah di sini.</p>
            <p>Lebar Layar (Real-time): <strong id="screen-width">--</strong> px</p>
        </div>

        <h3>2. Tes Ketersediaan API</h3>
        <div id="api-test-result" class="test-result">
            <p>localStorage: <strong id="local-storage-status">--</strong></p>
            <p>Geolocation: <strong id="geolocation-status">--</strong></p>
        </div>
        
        <h3>3. Tes Koneksi Jaringan</h3>
        <div id="network-test-result" class="test-result">
            Status: <strong id="network-status">--</strong>
        </div>

        <h2>Log Aktivitas:</h2>
        <div id="log-container">
            </div>
    </div>

 <script>
    // Ambil elemen yang dibutuhkan (Tetap sama)
    const elements = {
        testElement: document.getElementById('test-element'),
        logContainer: document.getElementById('log-container'),
        themeToggleBtn: document.getElementById('themeToggleBtn'),
        runAllTestsBtn: document.getElementById('runAllTestsBtn'),
        screenWidthDisplay: document.getElementById('screen-width'),
        localStorageStatus: document.getElementById('local-storage-status'),
        geolocationStatus: document.getElementById('geolocation-status'),
        networkStatus: document.getElementById('network-status'),
    };
    
    // Konstanta Jeda Waktu (Delay)
    const LOG_DELAY = 500; // 500 milidetik (0.5 detik)
    let logQueue = []; // Antrian Log
    let isProcessing = false; // Status pemrosesan

    // =================================================
    // FUNGSI UTILITY & FITUR LAMA
    // =================================================

    // [MODIFIKASI] Fungsi log sekarang mengantri pesan
    function logToScreen(msg, type = 'LOG') {
        // Cek jika pesan sudah berupa objek hasil dari fungsi tes (untuk log yang langsung ditampilkan)
        if (typeof msg === 'object' && msg !== null) {
            logQueue.push({ msg: msg.msg, type: msg.type });
        } else {
            logQueue.push({ msg, type });
        }
        
        // Mulai proses antrian jika belum berjalan
        if (!isProcessing) {
            processLogQueue();
        }
    }

    // [BARU] Fungsi untuk memproses antrian log satu per satu
    function processLogQueue() {
        if (logQueue.length === 0) {
            isProcessing = false;
            // Aktifkan kembali tombol setelah semua tes selesai
            elements.runAllTestsBtn.disabled = false; 
            elements.runAllTestsBtn.innerHTML = '<i class="fas fa-microchip"></i> Jalankan Semua Tes';
            return;
        }

        isProcessing = true;
        const nextLog = logQueue.shift();
        
        const logDiv = document.createElement('div');
        logDiv.classList.add('log-item');
        // Tambahkan animasi loading/fade-in
        logDiv.style.opacity = '0'; 
        logDiv.style.transform = 'translateY(10px)'; 
        logDiv.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
        
        logDiv.textContent = `[${nextLog.type}] ${new Date().toLocaleTimeString('id-ID')}: ${nextLog.msg}`;
        elements.logContainer.prepend(logDiv); // Tambahkan di atas
        
        // Paksakan reflow/redraw
        void logDiv.offsetWidth; 
        
        // Animasikan masuk
        logDiv.style.opacity = '1';
        logDiv.style.transform = 'translateY(0)';

        // Lanjutkan ke log berikutnya setelah jeda
        setTimeout(processLogQueue, LOG_DELAY);
    }

    // Fungsi toggleTheme & initializeTheme (Tidak perlu diubah, tetap pakai fungsi lama)
    function toggleTheme() {
        // ... (Kode toggleTheme lama) ...
        const isLight = document.body.classList.toggle('light-theme');
        document.body.classList.toggle('dark-theme', !isLight);
        
        if (isLight) {
            elements.themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i>';
            localStorage.setItem('theme', 'light');
        } else {
            elements.themeToggleBtn.innerHTML = '<i class="fas fa-sun"></i>';
            localStorage.setItem('theme', 'dark');
        }
        logToScreen({ msg: `Tema diubah menjadi: ${isLight ? 'Terang' : 'Gelap'}`, type: 'THEME' });
    }

    function initializeTheme() {
        // ... (Kode initializeTheme lama) ...
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.body.classList.remove('dark-theme', 'light-theme');
        
        if (savedTheme === 'light') {
            document.body.classList.add('light-theme');
            elements.themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i>';
        } else {
            document.body.classList.add('dark-theme');
            elements.themeToggleBtn.innerHTML = '<i class="fas fa-sun"></i>';
        }
    }


    // =================================================
    // FUNGSI UNTUK 4 JENIS TES BARU
    // (Fungsi ini sekarang hanya MENGUMPULKAN LOG, tidak langsung menampilkannya)
    // =================================================
    
    // 1. Tes DOM
    function testDom() {
        logToScreen({ msg: '1. Memulai Tes DOM...', type: 'DOM' });
        const el = elements.testElement;

        if (el) {
            el.textContent = 'BERHASIL DIUBAH! DOM OK.';
            el.style.color = '#ffce00'; 
            el.style.fontWeight = 'bold';
            logToScreen({ msg: 'Elemen DOM berhasil ditemukan dan dimanipulasi.', type: 'SUCCESS' });
        } else {
            el.textContent = 'GAGAL DITEMUKAN! DOM Bermasalah.';
            el.style.color = 'red';
            logToScreen({ msg: 'Elemen DOM GAGAL ditemukan.', type: 'ERROR' });
        }
    }
    
    // 1.b. Tes Responsivitas (Hanya update layar, log nanti di runAllTests)
    function updateScreenWidth() {
        const width = window.innerWidth;
        elements.screenWidthDisplay.textContent = width;
        // Log ini akan dipanggil manual di runAllTests untuk efek delay
    }

    // 2. Tes Ketersediaan API
    function testAPI() {
        logToScreen({ msg: '2. Memulai Tes Ketersediaan API...', type: 'API' });
        
        // Tes localStorage
        try {
            localStorage.setItem('test', '1');
            localStorage.removeItem('test');
            elements.localStorageStatus.textContent = 'TERSEDIA';
            elements.localStorageStatus.style.color = '#4CAF50';
            logToScreen({ msg: 'localStorage: OK. Data persisten dapat digunakan.', type: 'SUCCESS' });
        } catch (e) {
            elements.localStorageStatus.textContent = 'TIDAK TERSEDIA';
            elements.localStorageStatus.style.color = 'red';
            logToScreen({ msg: 'localStorage: GAGAL (Mungkin dinonaktifkan)', type: 'ERROR' });
        }

        // Tes Geolocation
        if ('geolocation' in navigator) {
            elements.geolocationStatus.textContent = 'TERSEDIA';
            elements.geolocationStatus.style.color = '#4CAF50';
            logToScreen({ msg: 'Geolocation: OK. Fitur lokasi tersedia.', type: 'SUCCESS' });
        } else {
            elements.geolocationStatus.textContent = 'TIDAK TERSEDIA';
            elements.geolocationStatus.style.color = 'red';
            logToScreen({ msg: 'Geolocation: GAGAL. Fitur lokasi tidak didukung.', type: 'ERROR' });
        }
    }
    
    // 3. Tes Koneksi Jaringan (Hanya untuk update display, log nanti di runAllTests)
    function updateNetworkStatus() {
        const isOnline = navigator.onLine;
        elements.networkStatus.textContent = isOnline ? 'ONLINE' : 'OFFLINE';
        elements.networkStatus.style.color = isOnline ? '#4CAF50' : 'red';
        // Log ini akan dipanggil manual di runAllTests untuk efek delay
    }

    // =================================================
    // [MODIFIKASI UTAMA] FUNGSI SEQUENTIAL TEST
    // =================================================

    function runAllTests() {
        if (isProcessing) return; // Cegah tombol ditekan berulang kali
        
        elements.logContainer.innerHTML = ''; // Bersihkan Log
        logQueue = []; // Reset antrian

        // Nonaktifkan tombol dan ubah teksnya menjadi Loading
        elements.runAllTestsBtn.disabled = true;
        elements.runAllTestsBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sedang Menguji...';

        logToScreen({ msg: '--- MEMULAI PROSES UJI 4 LANGKAH ---', type: 'START' });
        
        // Langkah 1: Tes DOM
        testDom();
        
        // Langkah 2: Tes Responsivitas
        logToScreen({ msg: '1.b. Memperbarui Lebar Layar...', type: 'SCREEN' });
        updateScreenWidth(); 
        logToScreen({ msg: `RESPONSIVITAS: Saat ini ${window.innerWidth}px.`, type: 'SUCCESS' });
        
        // Langkah 3: Tes Ketersediaan API
        testAPI();

        // Langkah 4: Tes Koneksi Jaringan
        logToScreen({ msg: '3. Memeriksa Status Koneksi Jaringan...', type: 'NETWORK' });
        updateNetworkStatus();
        
        logToScreen({ msg: '--- SEMUA TES DIMASUKKAN KE ANTRIAN ---', type: 'FINISH' });
        
        // Proses antrian akan dimulai otomatis di fungsi logToScreen pertama.
    }

    // =================================================
    // EVENT LISTENERS & INISIALISASI
    // =================================================

    document.addEventListener('DOMContentLoaded', () => {
        initializeTheme();
        
        // Panggil tes pertama kali saat dimuat untuk memberikan kesan MirAI yang langsung memuat data
        runAllTests(); 
        
        // Event Listeners
        elements.themeToggleBtn.addEventListener('click', toggleTheme);
        elements.runAllTestsBtn.addEventListener('click', runAllTests);

        // Real-time listener tetap aktif di background tanpa delay
        window.addEventListener('resize', updateScreenWidth);
        window.addEventListener('online', updateNetworkStatus);
        window.addEventListener('offline', updateNetworkStatus);
    });

</script>
</body>
</html>
